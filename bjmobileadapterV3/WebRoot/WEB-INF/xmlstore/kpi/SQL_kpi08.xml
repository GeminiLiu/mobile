<?xml version="1.0" encoding="UTF-8"?>
<sql-group>
	<doc>
		<author>liyudong</author> 
		<date>2011-07-20</date> 
		<description>KPI报表</description> 		
	</doc>	
	<sqlquery name="netck08" dbpoolname="">		
		<select>
		<![CDATA[ 			
select
b.BELONGNENAME as 地市,avg(nvl(b.NETCK011,0)) as 小区完好性
from
( select 
  to_date((case when to_number(to_char(sysdate,'ddd'))-6<1 then to_char(to_number(to_char(sysdate,'yyyy'))-1) else to_char(to_number(to_char(sysdate,'yyyy'))) end ) || '-' ||
  (case when to_number(to_char(sysdate,'ddd'))-6<1 then to_char(to_number(to_char( to_date(concat(to_number(to_char(sysdate,'yyyy')-1),concat('-','12-31')),'yyyy-MM-dd') ,'ww'))+(to_number(to_char(sysdate,'ddd'))-6)) else to_char(to_number(to_char(sysdate,'ddd'))-6) end ),'yyyy-ddd') as begintime,   
  to_date(to_char(sysdate,'yyyy-mm-dd'),'yyyy-mm-dd') as endtime   
  from dual) a,(select datetime,BELONGNENAME,NETCK011 from KPIINDEX_NETCK where datatype=1 and BelongneType='地区') b
  where to_date(substr(b.datetime,0,8),'yyyymmdd') >= begintime 
    and to_date(substr(b.datetime,0,8),'yyyymmdd') <= endtime
  group by BELONGNENAME    
		  ]]> 
		</select>
        		
	</sqlquery>	
    
</sql-group>


