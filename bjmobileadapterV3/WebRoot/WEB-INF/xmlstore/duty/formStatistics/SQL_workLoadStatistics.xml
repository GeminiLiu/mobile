<?xml version="1.0" encoding="UTF-8"?>
<sql-group>
	<doc>
		<author>lihongbo</author> 
		<date>2010-09-10</date> 
		<description>绩效考核_工作量统计</description> 		
	</doc>
	<sqlquery name="SQL_WorkLoadStatistics_incident" dbpoolname="">
		<select>
		<![CDATA[
			
		select
		--故障工单
			rp.fullname as fullname,
			rp.loginname as loginname,
			nvl(rs2.xj,0) as xj,
			nvl(rs1.sl,0) as sl,
			nvl(rs2.zp,0) as zp,
			nvl(rs2.hf,0) as hf,
			nvl(rs2.th,0) as th,
			nvl(rs1.cb,0) as cb,
			nvl(rs2.gd,0) as gd
			from
			--受理和催办
			(select
			acc.loginname,
			acc.fullname,
			sum(case when acc.dz='受理' then 1 else 0 end) as sl,
			sum(case when acc.dz='催办' then 1 else 0 end) as cb
			from
			(select t.c1 as id, dl.c700020404 as loginname, po.fullname as fullname,
			        dl.c700020402 as dz
			  from {WF:App_DealProcessLog} dl,
			       {WF:EL_TTM_TTH} t,
			       (select cc.user_id    as id,
			               su.c630000001 as loginname,
			               su.c630000003 as fullname
			          from duty_calendar dc, cnt_calendar cc, {UltraProcess:SysUser} su
			         where dc.calendar_id = cc.calendar_id
			           and cc.user_id = su.c630000029
			           #userName#
			           #createdate#
			         group by cc.user_id, su.c630000001, su.c630000003) po
			 where dl.c700020407 = t.c1
			   and dl.c700020408 = t.c700000001
			   #createtime#
			   $con_time$
			   and dl.c700020404 = po.loginname
			 group by t.c1, dl.c700020404, po.fullname,dl.c700020402) acc
			 group by acc.loginname,acc.fullname) rs1,
			 
			--新建和归档
			(
			 select 
			nc.loginname, 
			nc.fullname, 
			sum(case when nc.hjh='dp_1' then 1 else 0 end) as xj,
			sum(case when nc.hjh='dp_7' and nc.hjzt = '已归档' then 1 else 0 end) as gd,
			count(distinct case when (nc.hjh='dp_2' or nc.hjh='dp_4') and nc.hjzt = '已移交处理' then nc.id else '' end) as zp,
			count(distinct case when (nc.hjh='dp_2' or nc.hjh='dp_4' or nc.hjh='dp_6') and nc.hjzt = '已完成处理' then nc.id else '' end) as hf,
			sum(case when nc.hjh='dp_7' and nc.hjzt = '已退回处理' then 1 else 0 end) as th
			from
			(select t.c1 as id, po.loginname as loginname, po.fullname as fullname, dp.c700020003 as hjh, dp.c700020011 as hjzt
			  from {WF:App_DealProcess} dp,
			       {WF:EL_TTM_TTH} t,
			       (select cc.user_id    as id,
			               su.c630000001 as loginname,
			               su.c630000003 as fullname
			          from duty_calendar dc, cnt_calendar cc, {UltraProcess:SysUser} su
			         where dc.calendar_id = cc.calendar_id
			           and cc.user_id = su.c630000029
			           #userName#
			           #createdate#
			         group by cc.user_id, su.c630000001, su.c630000003) po
			 where dp.c700020001 = t.c1
			   and dp.c700020002 = t.c700000001
			   #createtime#
			   $con_time$
			   and (dp.c700020003 = 'dp_1' or dp.c700020003 = 'dp_2' or dp.c700020003 = 'dp_4' or dp.c700020003 = 'dp_6' or dp.c700020003 = 'dp_7')
			   and dp.c700020010 = po.loginname
			 group by t.c1,po.loginname, po.fullname, dp.c700020003, dp.c700020011) nc
			 group by nc.loginname,nc.fullname) rs2,
			 (select cc.user_id as id,
			               su.c630000001 as loginname,
			               su.c630000003 as fullname
			          from duty_calendar dc, cnt_calendar cc, {UltraProcess:SysUser} su
			         where dc.calendar_id = cc.calendar_id
			           and cc.user_id = su.c630000029
			           #userName#
			           #createdate#
			         group by cc.user_id, su.c630000001, su.c630000003) rp
			  where
			  rs1.loginname(+)=rp.loginname
			  and
			  rs2.loginname(+)=rp.loginname
		      order by rp.fullname 
		  ]]>
		</select>
		<customwhere>
			<parameterMap prepend="AND" name="con_time">
				<mapingFiled prepend="AND" fieldName="timeStart" fieldType="7">
					<mapsql value="isnotnull">
						<![CDATA[
							t.c700000006 >= #timeStart#
						 ]]>
					</mapsql>
				</mapingFiled>
				<mapingFiled prepend="AND" fieldName="timeEnd" fieldType="7">
					<mapsql value="isnotnull">
						<![CDATA[
							t.c700000006 <= #timeEnd#
						 ]]>
					</mapsql>
				</mapingFiled>
			</parameterMap>
		</customwhere>
		<rptatribute>
			<title>
			    <item>
					<titlecol>
					    <rowspan>2</rowspan>
						<text>姓名</text>
					</titlecol>	
					<titlecol>
					    <colspan>7</colspan>
						<text>故障工单</text>
					</titlecol>														
				</item>	
				<item>
				    
					<titlecol>
					    <enable>false</enable>
						<text>姓名</text>
					</titlecol>	
					<titlecol>
						<text>新建派发</text>
					</titlecol>	
					<titlecol>
						<text>受理</text>
					</titlecol>	
					<titlecol>
						<text>转派</text>
					</titlecol>	
					<titlecol>
						<text>回复</text>
					</titlecol>		
					<titlecol>
						<text>驳回</text>
					</titlecol>		
					<titlecol>
						<text>催办</text>
					</titlecol>		
					<titlecol>
						<text>归档</text>
					</titlecol>			
				   						
				</item>	
				
			</title>
			
		</rptatribute>
	</sqlquery>
	<sqlquery name="SQL_WorkLoadStatistics_complaint" dbpoolname="">
		<select>
		<![CDATA[
			
		select
		--投诉工单
		rp.loginname as loginname,
			rp.fullname as fullname,
			nvl(rs1.sl,0) as sl,
			nvl(rs2.zp,0) as zp,
			nvl(rs2.hf,0) as hf,
			nvl(rs2.bh,0) as bh,
			nvl(rs1.cb,0) as cb,
			nvl(rs2.zj,0) as zj
			from
			(select
			acc.loginname,
			acc.fullname,
			sum(case when acc.dz='受理' then 1 else 0 end) as sl,
			sum(case when acc.dz='催办' then 1 else 0 end) as cb
			from
			(select t.c1 as id, dl.c700020404 as loginname, po.fullname as fullname,
			        dl.c700020402 as dz
			  from {WF:App_DealProcessLog} dl,
			       {WF:EL_TTM_CCH} t,
			       (select cc.user_id    as id,
			               su.c630000001 as loginname,
			               su.c630000003 as fullname
			          from duty_calendar dc, cnt_calendar cc, {UltraProcess:SysUser} su
			         where dc.calendar_id = cc.calendar_id
			           and cc.user_id = su.c630000029
			           #userName#
			           #createdate#
			         group by cc.user_id, su.c630000001, su.c630000003) po
			 where dl.c700020407 = t.c1
			   and dl.c700020408 = t.c700000001
			   #createtime#
			   $con_time$
			   and dl.c700020404 = po.loginname
			 group by t.c1, dl.c700020404, po.fullname,dl.c700020402) acc
			 group by acc.loginname,acc.fullname) rs1,
			 
			 (select 
			nc.loginname, 
			nc.fullname, 
			count(distinct case when nc.hjh='dp_2' and nc.hjzt = '已移交处理' then nc.id else '' end) as zp,
			count(distinct case when nc.hjh='dp_5' and nc.hjzt = '已完成处理' then nc.id else '' end) as hf,
			count(distinct case when nc.hjh='dp_2' and nc.hjzt = '已驳回处理' then nc.id else '' end) as bh,
			count(distinct case when nc.hjh='dp_7' and nc.hjzt = '已质检通过' then nc.id else '' end) as zj
			from
			(select t.c1 as id, po.loginname as loginname, po.fullname as fullname, dp.c700020003 as hjh, dp.c700020011 as hjzt
			  from {WF:App_DealProcess} dp,
			       {WF:EL_TTM_CCH} t,
			       (select cc.user_id    as id,
			               su.c630000001 as loginname,
			               su.c630000003 as fullname
			          from duty_calendar dc, cnt_calendar cc, {UltraProcess:SysUser} su
			         where dc.calendar_id = cc.calendar_id
			           and cc.user_id = su.c630000029
			           #userName#
			           #createdate#
			         group by cc.user_id, su.c630000001, su.c630000003) po
			 where dp.c700020001 = t.c1
			   and dp.c700020002 = t.c700000001
			   #createtime#
			   $con_time$
			   and (dp.c700020003 = 'dp_2' or dp.c700020003 = 'dp_5' or dp.c700020003 = 'dp_7')
			   and dp.c700020010 = po.loginname
			 group by t.c1,po.loginname, po.fullname, dp.c700020003, dp.c700020011) nc
			 group by nc.loginname,nc.fullname) rs2,
			 (select cc.user_id as id,
			               su.c630000001 as loginname,
			               su.c630000003 as fullname
			          from duty_calendar dc, cnt_calendar cc, {UltraProcess:SysUser} su
			         where dc.calendar_id = cc.calendar_id
			           and cc.user_id = su.c630000029
			           #userName#
			           #createdate#
			         group by cc.user_id, su.c630000001, su.c630000003) rp
			   where
			  rs1.loginname(+)=rp.loginname
			  and
			  rs2.loginname(+)=rp.loginname
		      order by rp.fullname 
		  ]]>
		</select>
		<customwhere>
			<parameterMap prepend="AND" name="con_time">
				<mapingFiled prepend="AND" fieldName="timeStart" fieldType="7">
					<mapsql value="isnotnull">
						<![CDATA[
							t.c700000006 >= #timeStart#
						 ]]>
					</mapsql>
				</mapingFiled>
				<mapingFiled prepend="AND" fieldName="timeEnd" fieldType="7">
					<mapsql value="isnotnull">
						<![CDATA[
							t.c700000006 <= #timeEnd#
						 ]]>
					</mapsql>
				</mapingFiled>
			</parameterMap>
		</customwhere>
		<rptatribute>
			<title>
			    <item>
					<titlecol>
					    <rowspan>2</rowspan>
						<text>姓名</text>
					</titlecol>	
					<titlecol>
					    <colspan>6</colspan>
						<text>投诉工单</text>
					</titlecol>														
				</item>	
				<item>
				    
					<titlecol>
					    <enable>false</enable>
						<text>姓名</text>
					</titlecol>	
					<titlecol>
						<text>受理</text>
					</titlecol>	
					<titlecol>
						<text>转派</text>
					</titlecol>	
					<titlecol>
						<text>回复</text>
					</titlecol>		
					<titlecol>
						<text>驳回</text>
					</titlecol>		
					<titlecol>
						<text>催办</text>
					</titlecol>		
					<titlecol>
						<text>质检</text>
					</titlecol>			
				   						
				</item>	
				
			</title>
			
		</rptatribute>
	</sqlquery>
		<sqlquery name="SQL_WorkLoadStatistics_groups" dbpoolname="">
		<select>
		<![CDATA[
			
		select
		--集团任务工单
		rp.loginname as loginname,
			rp.fullname as fullname,
			nvl(rs1.xj,0) as xj,
			nvl(rs2.zp,0) as zp,
			nvl(rs2.bh,0) as bh,
			nvl(rs2.hf,0) as hf,
			nvl(rs3.cb,0) as cb,
			nvl(rs2.gd,0) as gd
			from
			(select po.loginname,po.fullname,count(distinct t.c1) as xj
			  from {WF:App_DealProcess} dp,
			       {WF:EL_UVS_TSK_NX} t,
			       (select cc.user_id    as id,
			               su.c630000001 as loginname,
			               su.c630000003 as fullname
			          from duty_calendar dc, cnt_calendar cc, {UltraProcess:SysUser} su
			         where dc.calendar_id = cc.calendar_id
			           and cc.user_id = su.c630000029
			           #userName#
			           #createdate#
			         group by cc.user_id, su.c630000001, su.c630000003) po
			 where dp.c700020001 = t.c1
			   and dp.c700020002 = t.c700000001
			   #createtime#
			   $con_time$
			   and dp.c700020004 = 'BEGIN'
			   and dp.c700020022 <> 1
			   and dp.c700020010 = po.loginname
			 group by po.loginname, po.fullname ) rs1,
			
			(select 
			nc.loginname, 
			nc.fullname, 
			sum(case when nc.hjzt='已移交' then 1 else 0 end) as zp,
			sum(case when nc.hjzt='已驳回' then 1 else 0 end) as bh,
			sum(case when nc.hjzt='已完成' then 1 else 0 end) as hf,
			sum(case when nc.hjzt='已关闭' then 1 else 0 end) as gd
			from
			(select t.c1 as id, po.loginname as loginname, po.fullname as fullname, dp.c700020011 as hjzt
			  from {WF:App_DealProcess} dp,
			       {WF:EL_UVS_TSK_NX} t,
			       (select cc.user_id    as id,
			               su.c630000001 as loginname,
			               su.c630000003 as fullname
			          from duty_calendar dc, cnt_calendar cc, {UltraProcess:SysUser} su
			         where dc.calendar_id = cc.calendar_id
			           and cc.user_id = su.c630000029
			           #userName#
			           #createdate#
			         group by cc.user_id, su.c630000001, su.c630000003) po
			 where dp.c700020001 = t.c1
			   and dp.c700020002 = t.c700000001
			   #createtime#
			   $con_time$
			   and dp.c700020010 = po.loginname
			 group by t.c1,po.loginname, po.fullname, dp.c700020011) nc
			 group by nc.loginname,nc.fullname) rs2,
			 
			 (select po.loginname,po.fullname,count(distinct t.c1) as cb
			  from {WF:App_DealProcessLog} dl,
			       {WF:EL_UVS_TSK_NX} t,
			       (select cc.user_id    as id,
			               su.c630000001 as loginname,
			               su.c630000003 as fullname
			          from duty_calendar dc, cnt_calendar cc, {UltraProcess:SysUser} su
			         where dc.calendar_id = cc.calendar_id
			           and cc.user_id = su.c630000029
			           #userName#
			           #createdate#
			         group by cc.user_id, su.c630000001, su.c630000003) po
			 where dl.c700020407 = t.c1
			   and dl.c700020408 = t.c700000001
			   #createtime#
			   $con_time$
			   and dl.c700020402 = '催办'
			   and dl.c700020404 = po.loginname
			 group by po.loginname,po.fullname) rs3,
			 (select cc.user_id as id,
			               su.c630000001 as loginname,
			               su.c630000003 as fullname
			          from duty_calendar dc, cnt_calendar cc, {UltraProcess:SysUser} su
			         where dc.calendar_id = cc.calendar_id
			           and cc.user_id = su.c630000029
			           #userName#
			           #createdate#
			         group by cc.user_id, su.c630000001, su.c630000003) rp
			where
			  rs1.loginname(+)=rp.loginname
			  and
			  rs2.loginname(+)=rp.loginname
			  and
			  rs3.loginname(+)=rp.loginname
		      order by rp.fullname 
		  ]]>
		</select>
		<customwhere>
			<parameterMap prepend="AND" name="con_time">
				<mapingFiled prepend="AND" fieldName="timeStart" fieldType="7">
					<mapsql value="isnotnull">
						<![CDATA[
							t.c700000006 >= #timeStart#
						 ]]>
					</mapsql>
				</mapingFiled>
				<mapingFiled prepend="AND" fieldName="timeEnd" fieldType="7">
					<mapsql value="isnotnull">
						<![CDATA[
							t.c700000006 <= #timeEnd#
						 ]]>
					</mapsql>
				</mapingFiled>
			</parameterMap>
		</customwhere>
		<rptatribute>
			<title>
			    <item>
					<titlecol>
					    <rowspan>2</rowspan>
						<text>姓名</text>
					</titlecol>	
					<titlecol>
					    <colspan>6</colspan>
						<text>集团任务工单</text>
					</titlecol>														
				</item>	
				<item>
				    
					<titlecol>
					    <enable>false</enable>
						<text>姓名</text>
					</titlecol>	
					<titlecol>
						<text>新建派发</text>
					</titlecol>	
					<titlecol>
						<text>转派</text>
					</titlecol>	
					<titlecol>
						<text>驳回</text>
					</titlecol>	
					<titlecol>
						<text>回复</text>
					</titlecol>		
					<titlecol>
						<text>催办</text>
					</titlecol>		
					<titlecol>
						<text>归档</text>
					</titlecol>			
				   						
				</item>	
				
			</title>
			
		</rptatribute>
	</sqlquery>
	<sqlquery name="SQL_WorkLoadStatistics_netnotes" dbpoolname="">
		<select>
		<![CDATA[
			
		select
		--网络工程通知工单
		rp.loginname as loginname,
			rp.fullname as fullname,
			nvl(rs2.sl,0) as sl,
			nvl(rs1.bh,0) as bh,
			nvl(rs1.zp,0) as zp,
			nvl(rs1.hf,0) as hf
			from
			(select 
			nc.loginname, 
			nc.fullname, 
			sum(case when nc.hjzt='已移交' then 1 else 0 end) as zp,
			sum(case when nc.hjzt='已驳回' then 1 else 0 end) as bh,
			sum(case when nc.hjzt='已完成' then 1 else 0 end) as hf
			from
			(select t.c1 as id, po.loginname as loginname, po.fullname as fullname, dp.c700020011 as hjzt
			  from {WF:App_DealProcess} dp,
			       {WF:EL_LCT_Math} t,
			       (select cc.user_id    as id,
			               su.c630000001 as loginname,
			               su.c630000003 as fullname
			          from duty_calendar dc, cnt_calendar cc, {UltraProcess:SysUser} su
			         where dc.calendar_id = cc.calendar_id
			           and cc.user_id = su.c630000029
			           #userName#
			           #createdate#
			         group by cc.user_id, su.c630000001, su.c630000003) po
			 where dp.c700020001 = t.c1
			   and dp.c700020002 = t.c700000001
			   #createtime#
			   $con_time$
			   and dp.c700020010 = po.loginname
			 group by t.c1,po.loginname, po.fullname, dp.c700020011) nc
			 group by nc.loginname,nc.fullname) rs1,
			 
			(select po.loginname,po.fullname,count(distinct t.c1) as sl
			  from {WF:App_DealProcessLog} dl,
			       {WF:EL_LCT_Math} t,
			       (select cc.user_id    as id,
			               su.c630000001 as loginname,
			               su.c630000003 as fullname
			          from duty_calendar dc, cnt_calendar cc, {UltraProcess:SysUser} su
			         where dc.calendar_id = cc.calendar_id
			           and cc.user_id = su.c630000029
			           #userName#
			           #createdate#
			         group by cc.user_id, su.c630000001, su.c630000003) po
			 where dl.c700020407 = t.c1
			   and dl.c700020408 = t.c700000001
			   #createtime#
			   $con_time$
			   and dl.c700020402 = '受理'
			   and dl.c700020404 = po.loginname
			 group by po.loginname,po.fullname) rs2,
			 (select cc.user_id as id,
			               su.c630000001 as loginname,
			               su.c630000003 as fullname
			          from duty_calendar dc, cnt_calendar cc, {UltraProcess:SysUser} su
			         where dc.calendar_id = cc.calendar_id
			           and cc.user_id = su.c630000029
			           #userName#
			           #createdate#
			         group by cc.user_id, su.c630000001, su.c630000003) rp
			 where
			  rs1.loginname(+)=rp.loginname
			  and
			  rs2.loginname(+)=rp.loginname
		      order by rp.fullname 
		  ]]>
		</select>
		<customwhere>
			<parameterMap prepend="AND" name="con_time">
				<mapingFiled prepend="AND" fieldName="timeStart" fieldType="7">
					<mapsql value="isnotnull">
						<![CDATA[
							t.c700000006 >= #timeStart#
						 ]]>
					</mapsql>
				</mapingFiled>
				<mapingFiled prepend="AND" fieldName="timeEnd" fieldType="7">
					<mapsql value="isnotnull">
						<![CDATA[
							t.c700000006 <= #timeEnd#
						 ]]>
					</mapsql>
				</mapingFiled>
			</parameterMap>
		</customwhere>
		<rptatribute>
			<title>
			    <item>
					<titlecol>
					    <rowspan>2</rowspan>
						<text>姓名</text>
					</titlecol>	
					<titlecol>
					    <colspan>4</colspan>
						<text>网络工程通知工单</text>
					</titlecol>														
				</item>	
				<item>
				    
					<titlecol>
					    <enable>false</enable>
						<text>姓名</text>
					</titlecol>	
					<titlecol>
						<text>受理</text>
					</titlecol>	
					<titlecol>
						<text>驳回</text>
					</titlecol>	
					<titlecol>
						<text>转派</text>
					</titlecol>	
					<titlecol>
						<text>回复</text>
					</titlecol>		
					
				</item>	
				
			</title>
			
		</rptatribute>
	</sqlquery>
		<sqlquery name="SQL_WorkLoadStatistics_noforms" dbpoolname="">
		<select>
		<![CDATA[
			
		 select 
			 --非工单投诉处理
			 rp.loginname as loginname,
			 rp.fullname as fullname,
			 nvl(rs1.fgdts,0) as fgdts
			 from
			 (select po.loginname as loginname, po.fullname as fullname, count(distinct apc.phone_complain_id) as fgdts
			   from app_phone_complain apc,
			        (select cc.user_id    as id,
			                su.c630000001 as loginname,
			                su.c630000003 as fullname
			           from duty_calendar dc, cnt_calendar cc, {UltraProcess:SysUser} su
			          where dc.calendar_id = cc.calendar_id
			            and cc.user_id = su.c630000029
			            #userName#
			            #createdate#
			          group by cc.user_id, su.c630000001, su.c630000003) po
			  where ltrim(apc.create_id, 0) = po.id
			    and apc.result = 1
			    and apc.state = 1
			    #noformstime#
			    $con_time$
			  group by po.loginname, po.fullname) rs1,
			  (select cc.user_id as id,
			               su.c630000001 as loginname,
			               su.c630000003 as fullname
			          from duty_calendar dc, cnt_calendar cc, {UltraProcess:SysUser} su
			         where dc.calendar_id = cc.calendar_id
			           and cc.user_id = su.c630000029
			           #userName#
			           #createdate#
			         group by cc.user_id, su.c630000001, su.c630000003) rp
			 where
			 rs1.loginname(+)=rp.loginname
		     order by rp.fullname 
		  ]]>
		</select>
		<customwhere>
			<parameterMap prepend="AND" name="con_time">
				<mapingFiled prepend="AND" fieldName="timeStart" fieldType="4">
					<mapsql value="isnotnull">
						<![CDATA[
							apc.create_time >= '#timeStart#'
						 ]]>
					</mapsql>
				</mapingFiled>
				<mapingFiled prepend="AND" fieldName="timeEnd" fieldType="4">
					<mapsql value="isnotnull">
						<![CDATA[
							apc.create_time <= '#timeEnd#'
						 ]]>
					</mapsql>
				</mapingFiled>
			</parameterMap>
		</customwhere>
		<rptatribute>
			<title>
			    <item>
			       
					<titlecol>
					    <rowspan>2</rowspan>
						<text>姓名</text>
					</titlecol>	
					<titlecol>
						<text>非工单投诉处理</text>
					</titlecol>																	
				</item>	
				<item>
				    
					<titlecol>
					    <enable>false</enable>
						<text>姓名</text>
					</titlecol>	
					<titlecol>
						<text>新建派发</text>
					</titlecol>																	
				</item>	
				
			</title>
			
		</rptatribute>
	</sqlquery>
</sql-group>