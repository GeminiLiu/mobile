<?xml version="1.0" encoding="UTF-8"?>
<sql-group>
	<doc>
		<author>作者</author> 
		<date>时间</date> 
		<description>对流程角色的查询</description> 		
	</doc>
	<sqlquery name="rolequery.ChildRole.ChileRoleTree">
		<select>
		<![CDATA[ 
			select
   			  /*COUNT*/  
			*
   			  /*COUNT*/  
			from
			(
   			  select
				distinct(cr.C700024001) as RoleID,
				cr.C1 as RoleC1,
				cr.C700024002 as RoleName,
				cr.C700024003 as ParentRoleID,
				cr.C700024004 as ParentRoleName,
				cr.C700024006 as RoleCondition
              from {WF:App_TplDealProcess} dp, {WF:App_TplBase_PerformRole} r, {WF:App_WorkFlowChildRole} cr 
              where 
              	r.C700022006 = dp.C700020003 and cr.C700024003 = r.C700022000 
              	$sch_rolepara$
              	order by RoleID asc
              )
		  ]]> 
		</select>
		<customwhere>
			<parameterMap prepend="AND" name="sch_rolepara">
				<mapingFiled  prepend="AND" fieldName="baseID"  fieldType="4">
					<mapsql value="isnotnull">
						<![CDATA[
							  dp.C700020001 = '#baseID#'
						 ]]>  			
					</mapsql>
				</mapingFiled>
				<mapingFiled  prepend="AND" fieldName="roleID"  fieldType="4">
					<mapsql value="isnotnull">
						<![CDATA[
							  r.C700022000 = '#roleID#'
						 ]]>  			
					</mapsql>
				</mapingFiled>
			</parameterMap>			
 		</customwhere>
	</sqlquery>
	<sqlquery name="rolequery.ChildRole.UserTree">
		<select>
		<![CDATA[ 
			select
   			  /*COUNT*/  
			*
   			  /*COUNT*/  
			from
			(
   			  select
				u.C101 as LoginName,
				u.C8   as FullName
              from {User} u 
              where 
              	$sch_userpara$
              )
		  ]]> 
		</select>
		<customwhere>
			<parameterMap prepend="" name="sch_userpara">
				<mapingFiled  prepend="AND" fieldName="groupID"  fieldType="4">
					<mapsql value="isnotnull">
						<![CDATA[
							';' || u.C640000000 || ';' like '%;#groupID#;%'
						 ]]>  			
					</mapsql>
				</mapingFiled>
			</parameterMap>			
 		</customwhere>
	</sqlquery>

	<sqlquery name="rolequery.ChildRole.BaseOn_ConnectionSelect">
		<select>
		<![CDATA[ 
   			  select 
   			  /*COUNT*/
				C1	as	RequestID,
				C700024008	as	CBDBaseName,
				C700024007	as	CBDBaseSchema,
				C700024006	as	ChildRoleDesc,
				C700024001	as	ChildRoleID,
				C700024002	as	ChildRoleName,
				C700024005	as	ChlidMatchDegree,
				C700024003	as	TopRoleID,
				C700024004	as	TopRoleName,
				C700024010	as	ChildRoleManager,
				C700024011	as	ChildRoleManagerID
			/*COUNT*/
              from {WF:App_WorkFlowChildRole} ChildRole
			  where $BaseOn_ConnectionSelect$ 
			  $extend$
		  ]]> 
		</select>
		<customwhere>
			<parameterMap prepend="" name="BaseOn_ConnectionSelect">
				<mapingFiled  prepend="" fieldName="is_notnull"  fieldType="4">
					<mapsql value="isnotnull">
						<![CDATA[
							 1=#is_notnull#
						 ]]>  			
					</mapsql>
				</mapingFiled>				
				<mapingFiled  prepend="AND" fieldName="baseschema"  fieldType="4">
					<mapsql value="isnotnull">
						<![CDATA[
							 C700024007 = '#baseschema#'
						 ]]>  			
					</mapsql>
				</mapingFiled>
				<mapingFiled  prepend="AND" fieldName="baseschemalist"  fieldType="4">
					<mapsql value="isnotnull">
						<![CDATA[
							 C700024007 in (#baseschemalist#)
						 ]]>  			
					</mapsql>
				</mapingFiled>
				<mapingFiled  prepend="AND" fieldName="toproleid"  fieldType="4">
					<mapsql value="isnotnull">
						<![CDATA[
							 C700024003 = '#toproleid#'
						 ]]>  			
					</mapsql>
				</mapingFiled>
				<mapingFiled  prepend="AND" fieldName="childroleid"  fieldType="4">
					<mapsql value="isnotnull">
						<![CDATA[
							 C700024001 = '#childroleid#'
						 ]]>  			
					</mapsql>
				</mapingFiled>
			</parameterMap>		
			<parameterMap prepend="EXTEND" name="extend">
					<mapingFiled  prepend="EXTEND" fieldName="orderby"  fieldType="4">
						<mapsql value="isnotnull">
							<![CDATA[
								   order by #orderby#
							 ]]>
						</mapsql>
					</mapingFiled>
			</parameterMap>					
		</customwhere>
	</sqlquery>	
</sql-group>
