<?xml version="1.0" encoding="GB2312"?>
<sql-group>
	<doc>
		<author>duanximeng</author>
		<date>2006-05-21</date>
		<description>
		</description>
	</doc>
	<!-- 受理用户-->
	<sql name="hbeoms.allformintimerolename" datasource="Ultranms">
		<item dbms="All"><![CDATA[
select
distinct(b.受理人) as 受理人,
nvl(a.工单总数,0) as 工单总数,
nvl(a.受理及时,0) as 受理及时,
nvl(a.受理及时率,'0%') as 受理及时率,
nvl(a.受理超时,0) as 受理超时,
nvl(a.受理超时率,'0%') as 受理超时率
from 
(select
distinct(pro.c700020009) as 受理人,
count(distinct(pro.C1)) as 工单总数,
sum(case when pro.c700020016-pro.c700020013 <=0 then 1 else 0 end) as 受理及时,
round(sum(case when pro.c700020016-pro.c700020013 <=0 then 1 else 0 end)/count(distinct(pro.C1)),4)*100 ||'%' as 受理及时率,
sum(case when pro.c700020016-pro.c700020013 >0 then 1 else 0 end) as 受理超时,
round(sum(case when pro.c700020016-pro.c700020013 >0 then 1 else 0 end)/count(distinct(pro.C1)),4)*100 ||'%' as 受理超时率
from {900} pro,{1000} t
where 
pro.c700020009 is not null
and t.C1=pro.C700020001
and pro.c700020011 in ('已完成','待处理','已派发','提交审批')
and pro.c700020019<>1
and pro.c700020019<>2
and pro.C700020016 is not null
and pro.C700020013 is not null
and pro.c700020002=t.c700000001
{1} {3}
group by pro.c700020009
union all
select
distinct(pro.c700020009) as 受理人,
count(distinct(pro.C1)) as 工单总数,
sum(case when pro.c700020016-pro.c700020013 <=0 then 1 else 0 end) as 受理及时,
round(sum(case when pro.c700020016-pro.c700020013 <=0 then 1 else 0 end)/count(distinct(pro.C1)),4)*100 ||'%' as 受理及时率,
sum(case when pro.c700020016-pro.c700020013 >0 then 1 else 0 end) as 受理超时,
round(sum(case when pro.c700020016-pro.c700020013 >0 then 1 else 0 end)/count(distinct(pro.C1)),4)*100 ||'%' as 受理超时率
from {800} pro,{1000} t
where 
pro.c700020009 is not null
and pro.c700020002=t.c700000001
and t.C1=pro.C700020001
and pro.c700020011 in ('已完成','待处理','已派发','提交审批')
and pro.c700020019<>1
and pro.c700020019<>2
and pro.C700020016 is not null
and pro.C700020013 is not null
{1} {3}
group by pro.c700020009) a,
(select u.C630000003 as 受理人 from {300} u where 1=1 {2}) b
where
a.受理人(+)=b.受理人

		]]></item>
	</sql>
	<!-- 受理部门-->
		<sql name="hbeoms.allformintimesendscopename" datasource="Ultranms">
		<item dbms="All"><![CDATA[
 select
distinct(d.受理部门) as 受理部门,
nvl(a.工单总数,0) as 工单总数,
nvl(b.受理及时,0) as 受理及时,
nvl(round((b.受理及时/a.工单总数)*100,4)||'%','0%') as 受理及时率,
nvl(c.受理超时,0) as 受理超时,
nvl(round((c.受理超时/a.工单总数)*100,4)||'%','0%') as 受理超时率
from 
(
select 
b.部门 as 受理部门,
a.工单总数
from 
(
select
distinct(g.C630000018) as 受理部门,
count(distinct(pro.C1)) as 工单总数
from (select * from {800} union all select * from {900}) pro,{1000} t,{300} u,{400} g,{500} gu 
where 
pro.c700020011 in ('已完成','待处理','已派发','提交审批','处理中')
and pro.c700020019<>1
and pro.c700020019<>2
and pro.C700020016 is not null
and pro.C700020013 is not null
{1} {3}
and g.C1=gu.C620000027 
and t.C1=pro.C700020001
and gu.C620000028=u.C1
and u.C630000003=pro.C700020009
and pro.c700020002=t.c700000001
group by g.C630000018
) a,
(select distinct g.c630000018 as 部门 from {400} g ) b
where a.受理部门(+)=b.部门
) a,
(
select 
b.部门 as 受理部门,
a.受理及时
from 
(
select
distinct(g.C630000018) as 受理部门,
count(distinct(pro.C1)) as 受理及时
from (select * from {800} union all select * from {900}) pro,{1000} t,{300} u,{400} g,{500} gu 
where 
pro.c700020016-pro.c700020013 <=0 
and pro.c700020011 in ('已完成','待处理','已派发','提交审批','处理中')
and pro.c700020019<>1
and pro.c700020019<>2
and pro.C700020016 is not null
and pro.C700020013 is not null
{1} {3}
and g.C1=gu.C620000027 
and gu.C620000028=u.C1
and u.C630000003=pro.C700020009
and pro.c700020002=t.c700000001
and t.C1=pro.C700020001
group by g.C630000018
) a,
(select distinct g.c630000018 as 部门 from {400} g ) b
where a.受理部门(+)=b.部门
) b,
(
select 
b.部门 as 受理部门,
a.受理超时
from 
(
select
distinct(g.C630000018) as 受理部门,
count(distinct(pro.C1)) as 受理超时
from (select * from {800} union all select * from {900}) pro,{1000} t,{300} u,{400} g,{500} gu 
where 
pro.c700020016-pro.c700020013 >0 
and pro.c700020011 in ('已完成','待处理','已派发','提交审批','处理中')
and pro.c700020019<>1
and pro.c700020019<>2
and pro.C700020016 is not null
and pro.C700020013 is not null
{1} {3}
and g.C1=gu.C620000027 
and gu.C620000028=u.C1
and u.C630000003=pro.C700020009
and pro.c700020002=t.c700000001
and t.C1=pro.C700020001
group by g.C630000018
) a,
(select distinct g.c630000018 as 部门 from {400} g ) b
where a.受理部门(+)=b.部门
) c,
(select g.C630000018 as 受理部门 from {400} g where 1=1 {2}  ) d
where a.受理部门=b.受理部门
and b.受理部门=c.受理部门
and c.受理部门=d.受理部门



		]]></item>
	</sql>
	<!-- 派单人-->
		<sql name="hbeoms.allformintimepfrolename" datasource="Ultranms">
		<item dbms="All"><![CDATA[
select
distinct(b.派单人) as 派单人,
nvl(a.工单总数,0) as 工单总数,
nvl(a.及时工单数,0) as 及时工单数,
nvl(a.及时率,'0%') as 及时率,
nvl(a.超时工单数,0) as 超时工单数,
nvl(a.超时率,'0%') as 超时率 ,
nvl(a.处理中工单数,0) as 处理中工单数,
nvl(a.处理中的工单比率,'0%') as 处理中的工单比率

from
(select 
t.c700000004 as 派单人,
count(distinct(t.C1)) as 工单总数,
sum(case when t.c700000008-t.c700000018<=0 then 1 else 0 end) as 及时工单数,
round(sum(case when t.c700000008-t.c700000018<=0 then 1 else 0 end )/(case when count(distinct(t.C1))=0 then 1 else count(distinct(t.C1)) end),4)*100 ||'%' as 及时率,
sum(case when t.c700000008-t.c700000018>0 then 1 else 0 end ) as 超时工单数,
round(sum(case when t.c700000008-t.c700000018>0 then 1 else 0 end )/(case when count(distinct(t.C1))=0 then 1 else count(distinct(t.C1)) end),4)*100 ||'%' as 超时率,
sum(case when t.c700000008 is null  then 1 else 0 end ) as 处理中工单数,
round(sum(case when t.c700000008 is null then 1 else 0 end )/(case when count(distinct(t.C1))=0 then 1 else count(distinct(t.C1)) end),4)*100 ||'%' as 处理中的工单比率

from {1000} t
where
--t.c700000008 is not null
--and t.c700000018 is not null
1=1 
{1} {3}
group by t.c700000004) a,
(select u.C630000003 as 派单人 from {300} u where 1=1 {2}) b
where
a.派单人(+)=b.派单人
		]]></item>
	</sql>
	<!-- 派单部门-->
		<sql name="hbeoms.allformintimesendpfscopename" datasource="Ultranms">
		<item dbms="All"><![CDATA[
select
distinct(b.派单部门) as 派单部门,
nvl(a.工单总数,0) as 工单总数,
nvl(a.及时工单数,0) as 及时工单数,
nvl(a.及时率,'0%') as 及时率,
nvl(a.超时工单数,0) as 超时工单数,
nvl(a.超时率,'0%') as 超时率,
nvl(a.处理中的工单数,0) as 处理中的工单数,
nvl(a.处理中的工单比率,'0%') as 处理中的工单比率  
from
(select 
g.c630000018 as 派单部门,
count(distinct(t.C1)) as 工单总数,
sum(case when t.c700000008-t.c700000018<=0 then 1 else 0 end) as 及时工单数,
round(sum(case when t.c700000008-t.c700000018<=0 then 1 else 0 end )/(case when count(distinct(t.C1))=0 then 1 else count(distinct(t.C1)) end),4)*100 ||'%' as 及时率,
sum(case when t.c700000008-t.c700000018>0 then 1 else 0 end ) as 超时工单数,
round(sum(case when t.c700000008-t.c700000018>0 then 1 else 0 end )/(case when count(distinct(t.C1))=0 then 1 else count(distinct(t.C1)) end),4)*100 ||'%' as 超时率,
sum(case when t.c700000008 is null then 1 else 0 end ) as 处理中的工单数,
round(sum(case when t.c700000008 is null then 1 else 0 end )/(case when count(distinct(t.C1))=0 then 1 else count(distinct(t.C1)) end),4)*100 ||'%' as 处理中的工单比率
from {1000} t,{300} u,{400} g,{500} gu
where
t.c700000005=u.c630000001
and u.C1=gu.c620000028
and gu.c620000027=g.C1
--and t.c700000008 is not null
--and t.c700000018 is not null
{1} {3}
group by g.c630000018) a,
(select g.C630000018 as 派单部门 from {400} g where 1=1 {2}) b
where 
a.派单部门(+)=b.派单部门
order by b.派单部门
		]]></item>
	</sql>
		<sql name="hbeoms.titlename" datasource="Ultranms">
		<item dbms="All"><![CDATA[
  
select 't'||t.schemaid,BaseCategory.C650000001 as basechname, BaseCategory.C650000002 as basename from {500} BaseCategory,arschema t
where  t.name=BaseCategory.C650000002 and t.schemaid={5}
		]]></item>
	</sql>
</sql-group>

