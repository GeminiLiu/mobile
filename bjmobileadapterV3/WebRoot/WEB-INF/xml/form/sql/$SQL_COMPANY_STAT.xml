<?xml version="1.0" encoding="GB2312"?>
<sql-group>
	<doc>
		<description>分公司统计</description>
	</doc>
	
	<!-- 投诉类型217-->
	<sql name="companystat.businesstype" datasource="Ultranms">
		<item dbms="All">
		<![CDATA[
		select distinct ty.c801800001 from {table} ty
		]]></item>
	</sql>	

<sql name="companystat.result" datasource="Ultranms">
<item dbms="All"><![CDATA[
		
select
distinct(comp.C801000018) as 处理客服,
sum(case when pro.C700020004='BEGIN' and comp.C801000018 not in (select g.C630000018 from t370 g  where g.C630000021=7) then 1 else 0 end) as 前台提交,
sum(case when pro.C700020004='BEGIN'and pro.C801000101=7 and comp.C801000018 not in (select g.C630000018 from t370 g  where g.C630000021=7) then 1 else 0 end) as 前台直接处理,
sum(case when pro.C700020004='BEGIN'and pro.C801000101=4 and pro.C700020017-pro.C700020014<=0 and comp.C801000018 in (select g.C630000018 from t370 g  where g.C630000021=7) then 1 else 0 end) as 后台复核派单及时,
sum(case when pro.C700020004='BEGIN'and pro.C801000101=4 and pro.C700020017-pro.C700020014>0 and comp.C801000018 in (select g.C630000018 from t370 g  where g.C630000021=7) then 1 else 0 end) as 后台复核派单超时,
sum(case when pro.C700020004='BEGIN'and pro.C801000101=7 and comp.C801000018 in (select g.C630000018 from t370 g  where g.C630000021=7) then 1 else 0 end) as 后台直接答复,
sum(case when (pro.C801000101=1 or pro.C801000101=4) and pro.C700020017-pro.C700020014<=0 then 1 else 0 end) as 派单及时,
sum(case when (pro.C801000101=1 or pro.C801000101=4) and pro.C700020017-pro.C700020014>0 then 1 else 0 end) as 派单超时,
sum(case when pro.C801000101 in (5,6,7,9) and pro.C700020017-pro.C700020014<=0 then 1 else 0 end) as 处理及时,
sum(case when pro.C801000101 in (5,6,7,9) and pro.C700020017-pro.C700020014>0 then 1 else 0 end) as 处理超时,
sum(case when pro.C801000101=8 and pro.C700020017-pro.C700020014<=0 then 1 else 0 end) as 反馈及时,
sum(case when pro.C801000101=8 and pro.C700020017-pro.C700020014>0 then 1 else 0 end) as 反馈超时,
sum(case when comp.C700000006+comp.C801800015*3600-comp.C700000008>=0 then 1 else 0 end) as 总体考察及时,
sum(case when comp.C700000006+comp.C801800015*3600-comp.C700000008<0 then 1 else 0 end) as 总体考察超时
from {table1} comp,{table3} pro,
where
comp.c700000007 > {start} and comp.c700000007 < {end} and 
comp.C1=pro.C700020001
{companystat.businesstype}
group by comp.C801000018

union all 
 
select
distinct(comp.C801000018) as 处理客服,
sum(case when pro.C700020004='BEGIN' and comp.C801000018 not in (select g.C630000018 from t370 g  where g.C630000021=7) then 1 else 0 end) as 前台提交,
sum(case when pro.C700020004='BEGIN'and pro.C801000101=7 and comp.C801000018 not in (select g.C630000018 from t370 g  where g.C630000021=7) then 1 else 0 end) as 前台直接处理,
sum(case when pro.C700020004='BEGIN'and pro.C801000101=4 and pro.C700020017-pro.C700020014<=0 and comp.C801000018 in (select g.C630000018 from t370 g  where g.C630000021=7) then 1 else 0 end) as 后台复核派单及时,
sum(case when pro.C700020004='BEGIN'and pro.C801000101=4 and pro.C700020017-pro.C700020014>0 and comp.C801000018 in (select g.C630000018 from t370 g  where g.C630000021=7) then 1 else 0 end) as 后台复核派单超时,
sum(case when pro.C700020004='BEGIN'and pro.C801000101=7 and comp.C801000018 in (select g.C630000018 from t370 g  where g.C630000021=7) then 1 else 0 end) as 后台直接答复,
sum(case when (pro.C801000101=1 or pro.C801000101=4) and pro.C700020017-pro.C700020014<=0 then 1 else 0 end) as 派单及时,
sum(case when (pro.C801000101=1 or pro.C801000101=4) and pro.C700020017-pro.C700020014>0 then 1 else 0 end) as 派单超时,
sum(case when pro.C801000101 in (5,6,7,9) and pro.C700020017-pro.C700020014<=0 then 1 else 0 end) as 处理及时,
sum(case when pro.C801000101 in (5,6,7,9) and pro.C700020017-pro.C700020014>0 then 1 else 0 end) as 处理超时,
sum(case when pro.C801000101=8 and pro.C700020017-pro.C700020014<=0 then 1 else 0 end) as 反馈及时,
sum(case when pro.C801000101=8 and pro.C700020017-pro.C700020014>0 then 1 else 0 end) as 反馈超时,
sum(case when comp.C700000006+comp.C801800015*3600-comp.C700000008>=0 then 1 else 0 end) as 总体考察及时,
sum(case when comp.C700000006+comp.C801800015*3600-comp.C700000008<0 then 1 else 0 end) as 总体考察超时
from {table1} comp,{table2} pro
where
comp.c700000007 > {start} and comp.c700000007 < {end} and
comp.C1=pro.C700020001
{companystat.businesstype}
group by comp.C801000018

]]></item>
</sql>
	
	
</sql-group>