<?xml version="1.0" encoding="GB2312"?>
<sql-group>
	<doc>
		<author>duanximeng</author>
		<date>2006-03-17</date>
		<description>投诉申告前后台处理统计
	</description>
	</doc>
	
	<sql name="Thmy_form_sum_number" datasource="Ultranms">
		<item dbms="All"><![CDATA[

select
ltrim('回访总数'),
type.C801800002,
count(distinct(t.C1)) || '' as 数量
from {100} t,(select distinct C801800002 from {700}) type, (select * from {200} union all select * from {300}) pro,{500} u,{400} g,{600} gu
,{500} uu,{400} gg,{600} gugu
where
1=1
and t.C1=pro.C700020001
and t.C700000005=u.C630000001
and u.C1=gu.C620000028
and gu.C620000027=g.C1
--and ( g.C630000037 like '%600001%')
{7}
and pro.c700020010=uu.C630000001
and uu.C1=gugu.C620000028
and gugu.C620000027=gg.C1
--and ( gg.C630000037 like '%600001%')
{6}
and (t.C801000003 like type.C801800002 || '%')
and t.c801000068 is not null
--and t.c801000068<>'未联系到客户'
--and t.c700000010<>'已作废'
--and t.c801000068<>'不需要回访'
{3}{5}
group by type.C801800002

union all

select
ltrim('成功总数'),
type.C801800002,
count(distinct(t.C1)) || '' as 数量
from {100} t,(select distinct C801800002 from {700}) type, (select * from {200} union all select * from {300}) pro,{500} u,{400} g,{600} gu
,{500} uu,{400} gg,{600} gugu
where
1=1
and t.C1=pro.C700020001
and t.C700000005=u.C630000001
and u.C1=gu.C620000028
and gu.C620000027=g.C1
--and ( g.C630000037 like '%600001%')
{7}
and pro.c700020010=uu.C630000001
and uu.C1=gugu.C620000028
and gugu.C620000027=gg.C1
--and ( gg.C630000037 like '%600001%')
{6}
and (t.C801000003 like type.C801800002 || '%')
and t.c801000068 is not null
and t.c801000068<>'未联系到客户'
and t.c801000068<>'不需要回访'
and t.c700000010<>'已作废'
{3}{5}
group by type.C801800002

union all

select
ltrim('成功率'),
a.类型,
round(b.数量/(case when a.数量=0 then 1 else a.数量 end),4)*100 || '%' as 成功率
from
(select
'回访总数',
type.C801800002 as 类型,
count(distinct(t.C1)) as 数量
from {100} t,(select distinct C801800002 from {700}) type, (select * from {200} union all select * from {300}) pro,{500} u,{400} g,{600} gu
,{500} uu,{400} gg,{600} gugu
where
1=1
and t.C1=pro.C700020001
and t.C700000005=u.C630000001
and u.C1=gu.C620000028
and gu.C620000027=g.C1
--and ( g.C630000037 like '%600001%')
{7}
and pro.c700020010=uu.C630000001
and uu.C1=gugu.C620000028
and gugu.C620000027=gg.C1
--and ( gg.C630000037 like '%600001%')
{6}
and (t.C801000003 like type.C801800002 || '%')
and t.c801000068 is not null
--and t.c801000068<>'未联系到客户'
--and t.c700000010<>'已作废'
--and t.c801000068<>'不需要回访'
{3}{5}
group by type.C801800002) a,
(select
ltrim('成功总数'),
type.C801800002 as 类型,
count(distinct(t.C1)) as 数量
from {100} t,(select distinct C801800002 from {700}) type, (select * from {200} union all select * from {300}) pro,{500} u,{400} g,{600} gu
,{500} uu,{400} gg,{600} gugu
where
1=1
and t.C1=pro.C700020001
and t.C700000005=u.C630000001
and u.C1=gu.C620000028
and gu.C620000027=g.C1
--and ( g.C630000037 like '%600001%')
{7}
and pro.c700020010=uu.C630000001
and uu.C1=gugu.C620000028
and gugu.C620000027=gg.C1
--and ( gg.C630000037 like '%600001%')
{6}
and (t.C801000003 like type.C801800002 || '%')
and t.c801000068 is not null
and t.c801000068<>'未联系到客户'
and t.c801000068<>'不需要回访'
and t.c700000010<>'已作废'
{3}{5}
group by type.C801800002) b
where a.类型=b.类型

union all

select
ltrim('满意数'),
type.C801800002,
count(distinct(t.C1)) || '' as 数量
from {100} t,(select distinct C801800002 from {700}) type, (select * from {200} union all select * from {300}) pro,{500} u,{400} g,{600} gu
,{500} uu,{400} gg,{600} gugu
where
1=1
and t.C1=pro.C700020001
and t.C700000005=u.C630000001
and u.C1=gu.C620000028
and gu.C620000027=g.C1
--and ( g.C630000037 like '%600001%')
{7}
and pro.c700020010=uu.C630000001
and uu.C1=gugu.C620000028
and gugu.C620000027=gg.C1
--and ( gg.C630000037 like '%600001%')
{6}
and (t.C801000003 like type.C801800002 || '%')
and t.c801000068 is not null
and (t.c801000068='非常满意' or t.c801000068='满意' or t.c801000068='一般')
and t.c700000010<>'已作废'
{3}{5}
group by type.C801800002

union all

select
ltrim('满意率'),
a.类型,
round(b.数量/(case when a.数量=0 then 1 else a.数量 end),4)*100 || '%' as 满意率
from
(select
ltrim('成功总数'),
type.C801800002 as 类型,
count(distinct(t.C1)) as 数量
from {100} t,(select distinct C801800002 from {700}) type, (select * from {200} union all select * from {300}) pro,{500} u,{400} g,{600} gu
,{500} uu,{400} gg,{600} gugu
where
1=1
and t.C1=pro.C700020001
and t.C700000005=u.C630000001
and u.C1=gu.C620000028
and gu.C620000027=g.C1
--and ( g.C630000037 like '%600001%')
{7}
and pro.c700020010=uu.C630000001
and uu.C1=gugu.C620000028
and gugu.C620000027=gg.C1
--and ( gg.C630000037 like '%600001%')
{6}
and (t.C801000003 like type.C801800002 || '%')
and t.c801000068 is not null
and t.c801000068<>'未联系到客户'
and t.c801000068<>'不需要回访'
and t.c700000010<>'已作废'
{3}{5}
group by type.C801800002
) a,
(select
ltrim('满意数'),
type.C801800002 as 类型,
count(distinct(t.C1)) as 数量
from {100} t,(select distinct C801800002 from {700}) type, (select * from {200} union all select * from {300}) pro,{500} u,{400} g,{600} gu
,{500} uu,{400} gg,{600} gugu
where
1=1
and t.C1=pro.C700020001
and t.C700000005=u.C630000001
and u.C1=gu.C620000028
and gu.C620000027=g.C1
--and ( g.C630000037 like '%600001%')
{7}
and pro.c700020010=uu.C630000001
and uu.C1=gugu.C620000028
and gugu.C620000027=gg.C1
--and ( gg.C630000037 like '%600001%')
{6}
and (t.C801000003 like type.C801800002 || '%')
and t.c801000068 is not null
and (t.c801000068='非常满意' or t.c801000068='满意' or t.c801000068='一般')
and t.c700000010<>'已作废'
{3}{5}
group by type.C801800002) b
where a.类型=b.类型
		]]></item>
	</sql>
	<sql name="Thmy_form_sum_type" datasource="Ultranms">
		<item dbms="All"><![CDATA[
select distinct c801800002 from {700} where c801800001='投诉' {3}
		]]></item>
	</sql>
</sql-group>

