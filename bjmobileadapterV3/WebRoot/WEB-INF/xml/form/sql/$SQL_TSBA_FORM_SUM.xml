<?xml version="1.0" encoding="GB2312"?>
<sql-group>
	<doc>
		<author>duanximeng</author>
		<date>2006-03-17</date>
		<description>投诉申告前后台处理统计
	</description>
	</doc>
		<sql name="Tsba_form_sum_type" datasource="Ultranms">
		<item dbms="All"><![CDATA[
		
 
  select type.项目1 as 项目,
         type.项目2 as 项目,
         type.项目3 as 项目,
         type.项目4 as 项目,
         type.项目5 as 项目,
         type.具体 as 具体     
  from 
  (select distinct  buss.c801800001 as 项目1,buss.c801800002 as 项目2 ,buss.c801800003 as 项目3, 
buss.c801800004 as 项目4, buss.c801800005 as 项目5,buss.c801800006 as 具体, buss.c801800007 from {100} buss
where 1=1  {1}
order  by buss.c801800007 desc,buss.c801800001, buss.c801800006  ) type

		]]></item>
	</sql>
	<sql name="Tsba_form_sum" datasource="Ultranms">
		<item dbms="All"><![CDATA[
          select
comp.C801000003 as 业务类型,
ltrim('前台工单受理量') as 数量,
count(distinct(comp.C1)) as 前台工单受理量
from {100} comp,(select * from {200} union all select * from {300}) pro,{500} u,{400} g,{600} gu
where
comp.C1=pro.C700020001
and comp.C700000005=u.C630000001
and u.C1=gu.C620000028
and gu.C620000027=g.C1
and pro.C700020004='BEGIN' and pro.c700020019=0 and pro.c700020022=0 
--and g.C630000021<>7
and comp.c700000010<>'已作废'
{6}
{10}
{4}
{7}
{5}
group by comp.C801000003

union all

select
comp.C801000003 as 业务类型,
ltrim('前台工单提交量') as 数量,
count(distinct(comp.C1)) as 前台工单提交量
from {100} comp,(select * from {200} union all select * from {300}) pro,{500} u,{400} g,{600} gu
where
comp.C1=pro.C700020001
and comp.C700000005=u.C630000001
and u.C1=gu.C620000028
and gu.C620000027=g.C1
and pro.C700020004='BEGIN' 
         and (pro.C700020019=0 or pro.C700020019=20) and  pro.C700020022=0 and pro.c700020011='已提交复核' 
--and pro.C801000101=0 
--and g.C630000021<>7
and comp.c700000010<>'已作废'
--and pro.c700020022=0
{6}
{10}
{4}
{7}
{5}
group by comp.C801000003

union all

select
comp.C801000003 as 业务类型,
ltrim('前台直接答复量') as 数量,
count(distinct(comp.C1)) as 前台直接答复量
from {100} comp,(select * from {200} union all select * from {300}) pro,{500} u,{400} g,{600} gu
where
comp.C1=pro.C700020001
and comp.C700000005=u.C630000001
and u.C1=gu.C620000028
and gu.C620000027=g.C1
and pro.C700020004='BEGIN' 
and pro.C801000101=7 
and g.C630000021<>7
and comp.c700000010<>'已作废'
{6}
{10}
{4}
{7}
{5}
group by comp.C801000003
union all
select
comp.C801000003 as 业务类型,
ltrim('后台直接答复量') as 数量,
count(distinct(comp.C1)) as 后台直接答复量
from {100} comp,(select * from {200} union all select * from {300}) pro,{500} u,{400} g,{600} gu
           where comp.C1 = pro.C700020001
           and pro.C700020010 = u.C630000001
           and u.C1 = gu.C620000028
           and u.C630000001 <> 'weizhiqiang'
           and u.C630000001 <> 'wzq'
           and gu.C620000027 = g.C1
           and pro.C700020019 = 20
           and pro.C700020022 = 0
           and pro.C801000101 = 7
           and comp.c700000010<>'已作废'
        
{6}
{10}
{4}
{7}
{5}
group by comp.C801000003
union all
select
comp.C801000003 as 业务类型,
ltrim('后台答复平均时长') as 数量,
round(avg(nvl(pro.C700020017,((to_date( to_char(sysdate,'yyyy-mm-dd hh24:mi:ss'), 'yyyy-mm-dd hh24:mi:ss')-to_date('1970-01-01 00:00:00','yyyy-mm-dd hh24:mi:ss')) * 3600 * 24))
      -pro.C700020015),0) as 后台答复平均时长
from {100} comp,(select * from {200} union all select * from {300}) pro,{500} u,{400} g,{600} gu
where
           comp.C1 = pro.C700020001
           and pro.C700020010 = u.C630000001
           and u.C1 = gu.C620000028
           and u.C630000001 <> 'weizhiqiang'
           and u.C630000001 <> 'wzq'
           and gu.C620000027 = g.C1
           and pro.C700020019 = 20
           and pro.C700020022 = 0
           and pro.C801000101 = 7
           and g.C630000021 = 7
and comp.c700000010<>'已作废'
{6}
{10}
{4}
{7}
{5}
group by comp.C801000003
union all
select
comp.C801000003 as 业务类型,
ltrim('后台复核派单量') as 数量,
count(distinct(comp.C1)) as 后台复核派单量
from {100} comp,(select * from {200} union all select * from {300}) pro,{500} u,{400} g,{600} gu
where
comp.C1=pro.C700020001
and comp.C700000005=u.C630000001
and u.C1=gu.C620000028
and gu.C620000027=g.C1
and (pro.c801000101=4 or pro.c801000101=2)

and comp.c700000010<>'已作废'
{6}
{10}
{4}
{7}
{5}
group by comp.C801000003
union all

select
comp.C801000003 as 业务类型,
ltrim('后台复核平均时长') as 数量,
round(avg(nvl(pro.C700020017,((to_date( to_char(sysdate,'yyyy-mm-dd hh24:mi:ss'), 'yyyy-mm-dd hh24:mi:ss')-to_date('1970-01-01 00:00:00','yyyy-mm-dd hh24:mi:ss')) * 3600 * 24))
-pro.C700020015),0) as 后台复核平均时长
from {100} comp,(select * from {200} union all select * from {300}) pro,{500} u,{400} g,{600} gu

where
comp.C1=pro.C700020001
and comp.C700000005=u.C630000001
and u.C1=gu.C620000028
and gu.C620000027=g.C1
and  (pro.c801000101=4 or pro.c801000101=2)

{6}
{10}
{4}
{7}
{5}
group by comp.C801000003
union all
select
C801000003 as 业务类型,
ltrim('自处理量') as 数量,count(C1) as 自处理量 from 
          (
select distinct(comp.C1),comp.C801000003
from (select * from {200} union all select * from {300}) pro,(select * from {200} union all select * from {300}) tt,{500} u,{100} comp ,{400} g,{600} gu,{500} mm,{600} gu1
where 
pro.C700020003=tt.C700020004 
and comp.c700000010<>'已作废'
and tt.C700020011='已完成'
and pro.C700020019=20 
and comp.C1=pro.C700020001
and comp.C1=tt.C700020001
and pro.C700020017<tt.C700020017
and tt.C700020010=u.C630000001
and u.C1=gu.C620000028
and pro.C700020010=mm.C630000001
and mm.C1=gu1.C620000028
and gu.C620000027=gu1.C620000027
and gu.C620000027=g.C1

{5}
{6}
{10}
{4}
{7}

union all
select distinct(comp.C1),comp.C801000003
from (select * from {200} union all select * from {300}) pro,{500} u,{100} comp ,{400} g,{600} gu
where (pro.C801000101=5 or (pro.C801000101=7 and pro.C700020019=20))
and pro.C700020001=comp.C1
 and comp.C700000005=u.C630000001
and u.C1=gu.C620000028
and gu.C620000027=g.C1
{5}
{6}
{10}
{4}
{7}
) 
group by C801000003	
union all

select
comp.C801000003 as 业务类型,
ltrim('后台建单量') as 数量,
count(distinct(comp.C1)) as 后台建单量
from {100} comp,(select * from {200} union all select * from {300}) pro,{500} u,{400} g,{600} gu
where
comp.C1=pro.C700020001
and comp.C700000005=u.C630000001
and u.C1=gu.C620000028
and gu.C620000027=g.C1
and  pro.C700020019=20 
and comp.C700000010<>'已作废'
{6}
{10}
{4}
{7}
{5}
group by comp.C801000003		  

		]]></item>
	</sql>
</sql-group>

