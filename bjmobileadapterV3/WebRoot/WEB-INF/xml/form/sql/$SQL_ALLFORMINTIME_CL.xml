<?xml version="1.0" encoding="GB2312"?>
<sql-group>
	<doc>
		<author>duanximeng</author>
		<date>2006-05-21</date>
		<description>
		</description>
	</doc>
	<!-- 处理用户from {900} pro,{1000} t  {1} {3} {300} u -->
	<sql name="hbeoms.allformintimerolename_cl" datasource="Ultranms">
		<item dbms="All"><![CDATA[
select distinct a.人员,
       a.工单总数,
       b.处理及时,
       round(b.处理及时/(case when a.工单总数=0 then 1 else a.工单总数 end),4)*100 || '%' as 处理及时率,
       d.处理超时,
       round(d.处理超时/(case when a.工单总数=0 then 1 else a.工单总数 end),4)*100 || '%' as 处理超时率,
       f.其他工单,
       round(f.其他工单/(case when a.工单总数=0 then 1 else a.工单总数 end),4)*100 || '%' as 其他工单比率
       from 

(select 
distinct b.人员,
nvl(a.工单总数,0) as 工单总数
from
          (select 
          distinct pro.C700020009  as 人员,
          count(distinct(t.C1)) as 工单总数
          from {1000} t,(select * from {800} union all select * from {900}) pro,{300} u
          where
          pro.c700020010=u.c630000001
          and t.c700000001=pro.c700020002
		{1}
		{2}
		{3}
          and t.C1=pro.C700020001 
          and pro.c700020004<>'BEGIN'
          and (pro.c700020011='已完成' or pro.C700020011='已派发')
          group by pro.C700020009) a,
(select u.C630000003 as 人员 from {300} u where 1=1 {2}) b
where a.人员(+)=b.人员) a,
-------------------------工单总数-----------------------------------
(select 
distinct b.人员,
nvl(a.处理及时,0) as 处理及时
from
          (select 
          distinct pro.C700020009   as 人员,
          count(distinct(t.C1))  as 处理及时
          from {1000} t,(select * from {800} union all select * from {900}) pro,{300} u
          where
          pro.c700020010=u.c630000001
          and t.c700000001=pro.c700020002
		{1}
		{2}
		{3} 
          and t.C1=pro.C700020001 
          and pro.c700020004<>'BEGIN'
          and (pro.c700020011='已完成' or pro.C700020011='已派发')
          and pro.c700020017-pro.c700020014<=0
          group by pro.C700020009
          ) a,
(select u.C630000003 as 人员 from {300} u where 1=1 {2}) b
where a.人员(+)=b.人员) b,
-------------------------处理及时-----------------------------------
(select 
distinct b.人员,
nvl(a.处理超时,0) as 处理超时
from  
        (select 
        distinct pro.C700020009  as 人员,
        count(distinct(t.C1))  as 处理超时
        from {1000} t,(select * from {800} union all select * from {900}) pro,{300} u
        where
        pro.c700020010=u.c630000001
        and t.c700000001=pro.c700020002
		{1}
		{2}
		{3} 
        and t.C1=pro.C700020001 
        and pro.c700020004<>'BEGIN'
        and (pro.c700020011='已完成' or pro.C700020011='已派发')
        and pro.c700020017-pro.c700020014>0
        group by pro.C700020009
        ) a,
(select u.C630000003 as 人员 from {300} u where 1=1 {2}) b
where a.人员(+)=b.人员) d,
-------------------------处理超时-----------------------------------
(select 
distinct b.人员,
nvl(a.其他工单,0) as 其他工单
from
              (select 
              distinct pro.C700020009  as 人员,
              count(distinct(t.C1)) as 其他工单
              from {1000} t,(select * from {800} union all select * from {900}) pro,{300} u
              where
              pro.c700020010=u.c630000001
              and t.c700000001=pro.c700020002
		{1}
		{2}
		{3} 
              
              and t.C1=pro.C700020001 
              and pro.c700020004<>'BEGIN'
              and (pro.c700020011='已完成' or pro.C700020011='已派发')
              and (pro.c700020017 is null or pro.c700020014 is null)
              group by pro.C700020009
              ) a,
(select u.C630000003 as 人员 from {300} u where 1=1 {2}) b
where a.人员(+)=b.人员) f
-------------------------处理超时率-----------------------------------

    where a.人员=b.人员
          and b.人员=d.人员
          and d.人员=f.人员
          order by a.人员

		]]></item>
	</sql>
	<!-- 处理部门-->
		<sql name="hbeoms.allformintimesendscopename_cl" datasource="Ultranms">
		<item dbms="All"><![CDATA[
 
select distinct a.部门,
       a.工单总数,
       b.处理及时,
       round(b.处理及时/(case when a.工单总数=0 then 1 else a.工单总数 end),4)*100 || '%' as 处理及时率,
       d.处理超时,
       round(d.处理超时/(case when a.工单总数=0 then 1 else a.工单总数 end),4)*100 || '%' as 处理超时率,
       f.其他工单,
       round(f.其他工单/(case when a.工单总数=0 then 1 else a.工单总数 end),4)*100 || '%' as 其他工单比率
       from 

(select 
distinct b.部门,
nvl(a.工单总数,0) as 工单总数
from
          (select 
          distinct g.c630000018  as 部门,
          count(distinct(t.C1)) as 工单总数
          from {1000} t,(select * from {800} union all select * from {900}) pro,{300} u,{400} g,{500} gu
          where
          pro.c700020010=u.c630000001
          and t.c700000001=pro.c700020002
          and gu.c620000027=g.c1
          and gu.c620000028=u.c1
		{1}
		{2}
		{3}
          and t.C1=pro.C700020001 
          and pro.c700020004<>'BEGIN'
          and (pro.c700020011='已完成' or pro.C700020011='已派发')
          group by g.c630000018) a,
(select distinct g.c630000018 as 部门 from {400} g where 1=1 {2}) b
where a.部门(+)=b.部门) a,
-------------------------工单总数-----------------------------------
(select 
distinct b.部门,
nvl(a.处理及时,0) as 处理及时
from
          (select 
          distinct g.c630000018  as 部门,
          count(distinct(t.C1))  as 处理及时
          from {1000} t,(select * from {800} union all select * from {900}) pro,{300} u,{400} g,{500} gu
          where
          pro.c700020010=u.c630000001
          and t.c700000001=pro.c700020002
          and gu.c620000027=g.c1
          and gu.c620000028=u.c1
		{1}
		{2}
		{3} 
          and t.C1=pro.C700020001 
          and pro.c700020004<>'BEGIN'
          and (pro.c700020011='已完成' or pro.C700020011='已派发')
          and pro.c700020017-pro.c700020014<=0
          group by g.c630000018
          ) a,
(select distinct g.c630000018 as 部门 from {400} g where 1=1 {2}) b
where a.部门(+)=b.部门) b,
-------------------------处理及时-----------------------------------
(select 
distinct b.部门,
nvl(a.处理超时,0) as 处理超时
from  
        (select 
        distinct g.c630000018  as 部门,
        count(distinct(t.C1))  as 处理超时
        from {1000} t,(select * from {800} union all select * from {900}) pro,{300} u,{400} g,{500} gu
        where
        pro.c700020010=u.c630000001
        and t.c700000001=pro.c700020002
        and gu.c620000027=g.c1
        and gu.c620000028=u.c1
		{1}
		{2}
		{3} 
        and t.C1=pro.C700020001 
        and pro.c700020004<>'BEGIN'
        and (pro.c700020011='已完成' or pro.C700020011='已派发')
        and pro.c700020017-pro.c700020014>0
        group by g.c630000018
        ) a,
(select distinct g.c630000018 as 部门 from {400} g where 1=1 {2}) b
where a.部门(+)=b.部门) d,
-------------------------处理超时-----------------------------------
(select 
distinct b.部门,
nvl(a.其他工单,0) as 其他工单
from
              (select 
              distinct g.c630000018  as 部门,
              count(distinct(t.C1)) as 其他工单
              from {1000} t,(select * from {800} union all select * from {900}) pro,{300} u,{400} g,{500} gu
              where
              pro.c700020010=u.c630000001
              and t.c700000001=pro.c700020002
              and gu.c620000027=g.c1
              and gu.c620000028=u.c1
		{1}
		{2}
		{3} 
              
              and t.C1=pro.C700020001 
              and pro.c700020004<>'BEGIN'
              and (pro.c700020011='已完成' or pro.C700020011='已派发')
              and (pro.c700020017 is null or pro.c700020014 is null)
              group by g.c630000018
              ) a,
(select distinct g.c630000018 as 部门 from {400} g where 1=1 {2}) b
where a.部门(+)=b.部门) f
-------------------------处理超时率-----------------------------------

    where a.部门=b.部门
          and b.部门=d.部门
          and d.部门=f.部门
          order by a.部门
		]]></item>
	</sql>
	<!-- 派单人-->
		<sql name="hbeoms.allformintimepfrolename_cl" datasource="Ultranms">
		<item dbms="All"><![CDATA[
select
distinct(b.派单人) as 派单人,
nvl(a.工单总数,0) as 工单总数,
nvl(a.及时工单数,0) as 及时工单数,
nvl(a.及时率,'0%') as 及时率,
nvl(a.超时工单数,0) as 超时工单数,
nvl(a.超时率,'0%') as 超时率 ,
nvl(a.处理中工单数,0) as 处理中工单数,
nvl(a.处理中的工单比率,'0%') as 处理中的工单比率

from
(select 
t.c700000004 as 派单人,
count(distinct(t.C1)) as 工单总数,
sum(case when t.c700000008-t.c700000018<=0 then 1 else 0 end) as 及时工单数,
round(sum(case when t.c700000008-t.c700000018<=0 then 1 else 0 end )/(case when count(distinct(t.C1))=0 then 1 else count(distinct(t.C1)) end),4)*100 ||'%' as 及时率,
sum(case when t.c700000008-t.c700000018>0 then 1 else 0 end ) as 超时工单数,
round(sum(case when t.c700000008-t.c700000018>0 then 1 else 0 end )/(case when count(distinct(t.C1))=0 then 1 else count(distinct(t.C1)) end),4)*100 ||'%' as 超时率,
sum(case when t.c700000008 is null  then 1 else 0 end ) as 处理中工单数,
round(sum(case when t.c700000008 is null then 1 else 0 end )/(case when count(distinct(t.C1))=0 then 1 else count(distinct(t.C1)) end),4)*100 ||'%' as 处理中的工单比率

from {1000} t
where
--t.c700000008 is not null
--and t.c700000018 is not null
1=1 
{1} {3}
group by t.c700000004) a,
(select u.C630000003 as 派单人 from {300} u where 1=1 {2}) b
where
a.派单人(+)=b.派单人
		]]></item>
	</sql>
	<!-- 派单部门-->
		<sql name="hbeoms.allformintimesendpfscopename_cl" datasource="Ultranms">
		<item dbms="All"><![CDATA[
select
distinct(b.派单部门) as 派单部门,
nvl(a.工单总数,0) as 工单总数,
nvl(a.及时工单数,0) as 及时工单数,
nvl(a.及时率,'0%') as 及时率,
nvl(a.超时工单数,0) as 超时工单数,
nvl(a.超时率,'0%') as 超时率,
nvl(a.处理中的工单数,0) as 处理中的工单数,
nvl(a.处理中的工单比率,'0%') as 处理中的工单比率  
from
(select 
g.c630000018 as 派单部门,
count(distinct(t.C1)) as 工单总数,
sum(case when t.c700000008-t.c700000018<=0 then 1 else 0 end) as 及时工单数,
round(sum(case when t.c700000008-t.c700000018<=0 then 1 else 0 end )/(case when count(distinct(t.C1))=0 then 1 else count(distinct(t.C1)) end),4)*100 ||'%' as 及时率,
sum(case when t.c700000008-t.c700000018>0 then 1 else 0 end ) as 超时工单数,
round(sum(case when t.c700000008-t.c700000018>0 then 1 else 0 end )/(case when count(distinct(t.C1))=0 then 1 else count(distinct(t.C1)) end),4)*100 ||'%' as 超时率,
sum(case when t.c700000008 is null then 1 else 0 end ) as 处理中的工单数,
round(sum(case when t.c700000008 is null then 1 else 0 end )/(case when count(distinct(t.C1))=0 then 1 else count(distinct(t.C1)) end),4)*100 ||'%' as 处理中的工单比率
from {1000} t,{300} u,{400} g,{500} gu
where
t.c700000005=u.c630000001
and u.C1=gu.c620000028
and gu.c620000027=g.C1
--and t.c700000008 is not null
--and t.c700000018 is not null
{1} {3}
group by g.c630000018) a,
(select g.C630000018 as 派单部门 from {400} g where 1=1 {2}) b
where 
a.派单部门(+)=b.派单部门
order by b.派单部门
		]]></item>
	</sql>
		<sql name="hbeoms.titlename_cl" datasource="Ultranms">
		<item dbms="All"><![CDATA[
  
select 't'||t.schemaid,BaseCategory.C650000001 as basechname, BaseCategory.C650000002 as basename from {500} BaseCategory,arschema t
where  t.name=BaseCategory.C650000002 and t.schemaid={5}
		]]></item>
	</sql>
</sql-group>

