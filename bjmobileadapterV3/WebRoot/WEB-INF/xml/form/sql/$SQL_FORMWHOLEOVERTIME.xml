<?xml version="1.0" encoding="GB2312"?>
<sql-group>
	<doc>
		<author>duanximeng</author>
		<date>2007</date>
		<description></description>
	</doc>
	
	<sql name="Form_whole_overtime" datasource="Ultranms">
		<item dbms="All"><![CDATA[

select
处理客服,
nvl(投诉工单总量,0) as 工单总量,
nvl(投诉工单超时量,0) as 超时量,
0 as 超时率,
nvl(受理工单总量,0) as 工单总量,
nvl(受理工单超时量,0) as 超时量,
0 as 超时率,
nvl(建议工单总量,0) as 工单总量,
nvl(建议工单超时量,0) as 超时量,
0 as 超时率,
nvl(咨询工单总量,0) as 工单总量,
nvl(咨询工单超时量,0) as 超时量,
0 as 超时率,
0 as 工单总量,
0 as 工单量,
0 as 超时率
from
(
select
distinct(a.处理客服) as 处理客服,
a.投诉工单总量 as 投诉工单总量,
b.投诉工单超时量 as 投诉工单超时量,
c.受理工单总量 as 受理工单总量,
d.受理工单超时量 as 受理工单超时量,
e.建议工单总量 as 建议工单总量,
f.建议工单超时量 as 建议工单超时量,
g.咨询工单总量 as 咨询工单总量,
h.咨询工单超时量 as 咨询工单超时量
from
(select
b.处理客服,
nvl(a.投诉工单总量,0) as 投诉工单总量
from
(select
          distinct(g.c630000018) as 处理客服,
          sum(case when t.c801000002='投诉' then 1 else 0 end) as 投诉工单总量
          from {100} t,{500} u,{400} g
          where 
          t.c700000010<>'已作废'
          and t.C700000005=u.C630000001
          and u.c630000013=g.c1
         {3}
       {4}
       {5}
         group by g.c630000018) a,
          (select t.C630000018 as 处理客服 from T145 t where 
	   	   			      t.C630000021='2' and 
                          ((t.C630000018 like '%分公司%') 
	   	   			   	  or (t.C630000018 like '%区客服%')
						  or (t.C630000018 like '%河北移动%'))
						  and (t.c630000018<>'administrator')
						  and (t.C630000018 <>'神州泰岳')
						  and (t.C630000018 <>'河北移动通讯股份有限公司')) b
          where a.处理客服(+)=b.处理客服)  a,
     
 (select
b.处理客服,
nvl(a.投诉工单超时量,0) as 投诉工单超时量
from
(select 
       distinct(处理客服) as 处理客服,
       sum(投诉工单超时量) as 投诉工单超时量
       from(
        select 
        g.c630000018 as 处理客服 ,
        sum(case when t.C801000002='投诉' and ((probak.C700020017 - t.C700000006) - t.C801800015 * 1800) > 0 then 1 else 0 end) as 投诉工单超时量
        from {100} t,{500} u,{400} g,(select *from t94  union all select * from t95) propre,(select *from t94  union all select * from t95) probak
        where 
        t.c700000010<>'已作废'
        and ((propre.C700020011 = '已完成' or propre.C700020011 = '已关闭') and propre.c700020019 = 20)
        and probak.C700020020 = 0
        and probak.C700020011 = '已完成'
        and probak.C700020004 = propre.C700020003
        and t.c1 = propre.C700020001
        and t.c1 = probak.C700020001
        and probak.c801000103 = 0
        and t.C700000005=u.C630000001
        and u.c630000013=g.c1
        and g.C630000021='2'
       -- and (  t.c801000016='全球通普通客户' or t.c801000016='未知' or t.c801000016='他网客户' or t.c801000016='本地固话客户' or t.c801000016='异地漫游客户' or t.c801000016='神州行客户' or t.c801000016='动感地带客户' or t.c801000016='长途固话客户' or t.c801000016='集团客户' or t.c801000016='贵宾卡' or t.c801000016='VIP银卡' or t.c801000016='VIP金卡' or t.c801000016='VIP钻石卡' or t.c801000016='国际漫游客户') and 1183219200000<(t.c700000006)*1000 and (t.c700000006)*1000<1193068800000  and (  t.c801000018='省中心' or t.c801000018='集团' or t.c801000018='石家庄' or t.c801000018='保定' or t.c801000018='衡水' or t.c801000018='邢台' or t.c801000018='邯郸' or t.c801000018='张家口' or t.c801000018='承德' or t.c801000018='唐山' or t.c801000018='廊坊' or t.c801000018='沧州' or t.c801000018='秦皇岛')
        {3}
       {4}
       {5}
        group by g.c630000018
        union 
        select 
         g.c630000018 as 处理客服 ,
        sum(case when t.C801000002='投诉' and ((probak.C700020017 - t.C700000006) - t.C801800015 * 1800) > 0 then 1 else 0 end) as 投诉工单超时量
        from {100} t,{500} u,{400} g,(select *from t94  union all select * from t95) propre,(select *from t94  union all select * from t95) probak
        where ((propre.C700020011 = '已完成' or propre.C700020011 = '已关闭') and
               propre.c700020019 = 20)
           and probak.C700020020 = 0
           and (probak.C700020011 = '已驳回' or probak.C700020011 = '已追回')
           and probak.C700020004 = propre.C700020003
            and t.c1 = propre.C700020001
           and t.c1 = probak.C700020001
        and probak.c801000103 = 0
        and t.C700000005=u.C630000001
        and u.c630000013=g.c1
        and g.C630000021='2'
       -- and (  t.c801000016='全球通普通客户' or t.c801000016='未知' or t.c801000016='他网客户' or t.c801000016='本地固话客户' or t.c801000016='异地漫游客户' or t.c801000016='神州行客户' or t.c801000016='动感地带客户' or t.c801000016='长途固话客户' or t.c801000016='集团客户' or t.c801000016='贵宾卡' or t.c801000016='VIP银卡' or t.c801000016='VIP金卡' or t.c801000016='VIP钻石卡' or t.c801000016='国际漫游客户') and 1183219200000<(t.c700000006)*1000 and (t.c700000006)*1000<1193068800000  and (  t.c801000018='省中心' or t.c801000018='集团' or t.c801000018='石家庄' or t.c801000018='保定' or t.c801000018='衡水' or t.c801000018='邢台' or t.c801000018='邯郸' or t.c801000018='张家口' or t.c801000018='承德' or t.c801000018='唐山' or t.c801000018='廊坊' or t.c801000018='沧州' or t.c801000018='秦皇岛')
        {3}
       {4}
       {5}
        group by g.c630000018
        union
        select 
         g.c630000018 as 处理客服 ,
        sum(case when t.C801000002='投诉' and ((probak.C700020017 - t.C700000006) - t.C801800015 * 1800) > 0 then 1 else 0 end) as 投诉工单超时量
       from {100} t,{500} u,{400} g,(select *from t94  union all select * from t95) probak
         where (probak.C700020011 = '已关闭')
           and (probak.C700020019 = 0 or probak.C700020019 = 20)
           and probak.c801000101 = 7
           and t.c1 = probak.C700020001
         and probak.c801000103 = 0
         and t.C700000005=u.C630000001
        and u.c630000013=g.c1
        and g.C630000021='2'
       -- and (  t.c801000016='全球通普通客户' or t.c801000016='未知' or t.c801000016='他网客户' or t.c801000016='本地固话客户' or t.c801000016='异地漫游客户' or t.c801000016='神州行客户' or t.c801000016='动感地带客户' or t.c801000016='长途固话客户' or t.c801000016='集团客户' or t.c801000016='贵宾卡' or t.c801000016='VIP银卡' or t.c801000016='VIP金卡' or t.c801000016='VIP钻石卡' or t.c801000016='国际漫游客户') and 1183219200000<(t.c700000006)*1000 and (t.c700000006)*1000<1193068800000  and (  t.c801000018='省中心' or t.c801000018='集团' or t.c801000018='石家庄' or t.c801000018='保定' or t.c801000018='衡水' or t.c801000018='邢台' or t.c801000018='邯郸' or t.c801000018='张家口' or t.c801000018='承德' or t.c801000018='唐山' or t.c801000018='廊坊' or t.c801000018='沧州' or t.c801000018='秦皇岛')
        {3}
       {4}
       {5}
        group by g.c630000018
        union
        select 
         g.c630000018 as 处理客服 ,
        sum(case when t.C801000002='投诉' and ((((to_date(to_char(sysdate, 'yyyy-mm-dd hh24:mi:ss'),
                           'yyyy-mm-dd hh24:mi:ss') -
               to_date('1970-01-01 00:00:00', 'yyyy-mm-dd hh24:mi:ss')) * 3600 * 24) -
               t.C700000006) - t.C801800015 * 1800) > 0 then 1 else 0 end) as 投诉工单超时量
        
          from {100} t,{500} u,{400} g,(select *from t94  union all select * from t95) propre
           
         where (propre.c700020011='处理中' or propre.c700020011='待处理')
           and t.c1 = propre.C700020001
           and (propre.c700020020= 1 or propre.c700020020= 2)
           and propre.c801000103 = 0
          and t.C700000005=u.C630000001
        and u.c630000013=g.c1
        and g.C630000021='2'
        --and (  t.c801000016='全球通普通客户' or t.c801000016='未知' or t.c801000016='他网客户' or t.c801000016='本地固话客户' or t.c801000016='异地漫游客户' or t.c801000016='神州行客户' or t.c801000016='动感地带客户' or t.c801000016='长途固话客户' or t.c801000016='集团客户' or t.c801000016='贵宾卡' or t.c801000016='VIP银卡' or t.c801000016='VIP金卡' or t.c801000016='VIP钻石卡' or t.c801000016='国际漫游客户') and 1183219200000<(t.c700000006)*1000 and (t.c700000006)*1000<1193068800000  and (  t.c801000018='省中心' or t.c801000018='集团' or t.c801000018='石家庄' or t.c801000018='保定' or t.c801000018='衡水' or t.c801000018='邢台' or t.c801000018='邯郸' or t.c801000018='张家口' or t.c801000018='承德' or t.c801000018='唐山' or t.c801000018='廊坊' or t.c801000018='沧州' or t.c801000018='秦皇岛')
        {3}
       {4}
       {5}
        group by g.c630000018
     ) group by 处理客服) a,
          (select t.C630000018 as 处理客服 from T145 t where 
	   	   			      t.C630000021='2' and 
                          ((t.C630000018 like '%分公司%') 
	   	   			   	  or (t.C630000018 like '%区客服%')
						  or (t.C630000018 like '%河北移动%'))
						  and (t.c630000018<>'administrator')
						  and (t.C630000018 <>'神州泰岳')
						  and (t.C630000018 <>'河北移动通讯股份有限公司')) b
          where a.处理客服(+)=b.处理客服)  b,
          
  
 (select
b.处理客服,
nvl(a.受理工单总量,0) as 受理工单总量
from
(select
          distinct(g.c630000018) as 处理客服,
          sum(case when t.c801000002='受理' then 1 else 0 end) as 受理工单总量
          from {100} t,{500} u,{400} g
          where 
          t.c700000010<>'已作废'
          and t.C700000005=u.C630000001
          and u.c630000013=g.c1
         {3}
       {4}
       {5}
         group by g.c630000018) a,
          (select t.C630000018 as 处理客服 from T145 t where 
	   	   			      t.C630000021='2' and 
                          ((t.C630000018 like '%分公司%') 
	   	   			   	  or (t.C630000018 like '%区客服%')
						  or (t.C630000018 like '%河北移动%'))
						  and (t.c630000018<>'administrator')
						  and (t.C630000018 <>'神州泰岳')
						  and (t.C630000018 <>'河北移动通讯股份有限公司')) b
          where a.处理客服(+)=b.处理客服) c,
          
          
 (select
b.处理客服,
nvl(a.受理工单超时量,0) as 受理工单超时量
from
(select 
       distinct(处理客服) as 处理客服,
       sum(受理工单超时量) as 受理工单超时量
       from(
        select 
        g.c630000018 as 处理客服 ,
        sum(case when t.C801000002='受理' and ((probak.C700020017 - t.C700000006) - t.C801800015 * 1800) > 0 then 1 else 0 end) as 受理工单超时量
        from {100} t,{500} u,{400} g,(select *from t94  union all select * from t95) propre,(select *from t94  union all select * from t95) probak
        where 
        t.c700000010<>'已作废'
        and ((propre.C700020011 = '已完成' or propre.C700020011 = '已关闭') and propre.c700020019 = 20)
        and probak.C700020020 = 0
        and probak.C700020011 = '已完成'
        and probak.C700020004 = propre.C700020003
        and t.c1 = propre.C700020001
        and t.c1 = probak.C700020001
        and probak.c801000103 = 0
        and t.C700000005=u.C630000001
        and u.c630000013=g.c1
        and g.C630000021='2'
       -- and (  t.c801000016='全球通普通客户' or t.c801000016='未知' or t.c801000016='他网客户' or t.c801000016='本地固话客户' or t.c801000016='异地漫游客户' or t.c801000016='神州行客户' or t.c801000016='动感地带客户' or t.c801000016='长途固话客户' or t.c801000016='集团客户' or t.c801000016='贵宾卡' or t.c801000016='VIP银卡' or t.c801000016='VIP金卡' or t.c801000016='VIP钻石卡' or t.c801000016='国际漫游客户') and 1183219200000<(t.c700000006)*1000 and (t.c700000006)*1000<1193068800000  and (  t.c801000018='省中心' or t.c801000018='集团' or t.c801000018='石家庄' or t.c801000018='保定' or t.c801000018='衡水' or t.c801000018='邢台' or t.c801000018='邯郸' or t.c801000018='张家口' or t.c801000018='承德' or t.c801000018='唐山' or t.c801000018='廊坊' or t.c801000018='沧州' or t.c801000018='秦皇岛')
        {3}
       {4}
       {5}
        group by g.c630000018
        union 
        select 
         g.c630000018 as 处理客服 ,
        sum(case when t.C801000002='受理' and ((probak.C700020017 - t.C700000006) - t.C801800015 * 1800) > 0 then 1 else 0 end) as 受理工单超时量
        from {100} t,{500} u,{400} g,(select *from t94  union all select * from t95) propre,(select *from t94  union all select * from t95) probak
        where ((propre.C700020011 = '已完成' or propre.C700020011 = '已关闭') and
               propre.c700020019 = 20)
           and probak.C700020020 = 0
           and (probak.C700020011 = '已驳回' or probak.C700020011 = '已追回')
           and probak.C700020004 = propre.C700020003
            and t.c1 = propre.C700020001
           and t.c1 = probak.C700020001
        and probak.c801000103 = 0
        and t.C700000005=u.C630000001
        and u.c630000013=g.c1
        and g.C630000021='2'
       -- and (  t.c801000016='全球通普通客户' or t.c801000016='未知' or t.c801000016='他网客户' or t.c801000016='本地固话客户' or t.c801000016='异地漫游客户' or t.c801000016='神州行客户' or t.c801000016='动感地带客户' or t.c801000016='长途固话客户' or t.c801000016='集团客户' or t.c801000016='贵宾卡' or t.c801000016='VIP银卡' or t.c801000016='VIP金卡' or t.c801000016='VIP钻石卡' or t.c801000016='国际漫游客户') and 1183219200000<(t.c700000006)*1000 and (t.c700000006)*1000<1193068800000  and (  t.c801000018='省中心' or t.c801000018='集团' or t.c801000018='石家庄' or t.c801000018='保定' or t.c801000018='衡水' or t.c801000018='邢台' or t.c801000018='邯郸' or t.c801000018='张家口' or t.c801000018='承德' or t.c801000018='唐山' or t.c801000018='廊坊' or t.c801000018='沧州' or t.c801000018='秦皇岛')
        {3}
       {4}
       {5}
        group by g.c630000018
        union
        select 
         g.c630000018 as 处理客服 ,
        sum(case when t.C801000002='受理' and ((probak.C700020017 - t.C700000006) - t.C801800015 * 1800) > 0 then 1 else 0 end) as 受理工单超时量
        from {100} t,{500} u,{400} g,(select *from t94  union all select * from t95) probak
         where (probak.C700020011 = '已关闭')
           and (probak.C700020019 = 0 or probak.C700020019 = 20)
           and probak.c801000101 = 7
           and t.c1 = probak.C700020001
           and probak.c801000103 = 0
         and t.C700000005=u.C630000001
        and u.c630000013=g.c1
        and g.C630000021='2'
        --and (  t.c801000016='全球通普通客户' or t.c801000016='未知' or t.c801000016='他网客户' or t.c801000016='本地固话客户' or t.c801000016='异地漫游客户' or t.c801000016='神州行客户' or t.c801000016='动感地带客户' or t.c801000016='长途固话客户' or t.c801000016='集团客户' or t.c801000016='贵宾卡' or t.c801000016='VIP银卡' or t.c801000016='VIP金卡' or t.c801000016='VIP钻石卡' or t.c801000016='国际漫游客户') and 1183219200000<(t.c700000006)*1000 and (t.c700000006)*1000<1193068800000  and (  t.c801000018='省中心' or t.c801000018='集团' or t.c801000018='石家庄' or t.c801000018='保定' or t.c801000018='衡水' or t.c801000018='邢台' or t.c801000018='邯郸' or t.c801000018='张家口' or t.c801000018='承德' or t.c801000018='唐山' or t.c801000018='廊坊' or t.c801000018='沧州' or t.c801000018='秦皇岛')
        {3}
       {4}
       {5}
        group by g.c630000018
        union
        select 
         g.c630000018 as 处理客服 ,
        sum(case when t.C801000002='受理' and ((((to_date(to_char(sysdate, 'yyyy-mm-dd hh24:mi:ss'),
                           'yyyy-mm-dd hh24:mi:ss') -
               to_date('1970-01-01 00:00:00', 'yyyy-mm-dd hh24:mi:ss')) * 3600 * 24) -
               t.C700000006) - t.C801800015 * 1800) > 0 then 1 else 0 end) as 受理工单超时量
        
          from {100} t,{500} u,{400} g,(select *from t94  union all select * from t95) propre
           
         where (propre.c700020011='处理中' or propre.c700020011='待处理')
           and t.c1 = propre.C700020001
           and (propre.c700020020= 1 or propre.c700020020= 2)
           --and propre.c801000103 = 0
          and t.C700000005=u.C630000001
        and u.c630000013=g.c1
        and g.C630000021='2'
       -- and (  t.c801000016='全球通普通客户' or t.c801000016='未知' or t.c801000016='他网客户' or t.c801000016='本地固话客户' or t.c801000016='异地漫游客户' or t.c801000016='神州行客户' or t.c801000016='动感地带客户' or t.c801000016='长途固话客户' or t.c801000016='集团客户' or t.c801000016='贵宾卡' or t.c801000016='VIP银卡' or t.c801000016='VIP金卡' or t.c801000016='VIP钻石卡' or t.c801000016='国际漫游客户') and 1183219200000<(t.c700000006)*1000 and (t.c700000006)*1000<1193068800000  and (  t.c801000018='省中心' or t.c801000018='集团' or t.c801000018='石家庄' or t.c801000018='保定' or t.c801000018='衡水' or t.c801000018='邢台' or t.c801000018='邯郸' or t.c801000018='张家口' or t.c801000018='承德' or t.c801000018='唐山' or t.c801000018='廊坊' or t.c801000018='沧州' or t.c801000018='秦皇岛')
        {3}
       {4}
       {5}
        group by g.c630000018
     ) group by 处理客服) a,
          (select t.C630000018 as 处理客服 from T145 t where 
	   	   			      t.C630000021='2' and 
                          ((t.C630000018 like '%分公司%') 
	   	   			   	  or (t.C630000018 like '%区客服%')
						  or (t.C630000018 like '%河北移动%'))
						  and (t.c630000018<>'administrator')
						  and (t.C630000018 <>'神州泰岳')
						  and (t.C630000018 <>'河北移动通讯股份有限公司')) b
          where a.处理客服(+)=b.处理客服)  d,
   
   
   
    (select
b.处理客服,
nvl(a.建议工单总量,0) as 建议工单总量
from
(select
          distinct(g.c630000018) as 处理客服,
          sum(case when t.c801000002='建议' then 1 else 0 end) as 建议工单总量
          from {100} t,{500} u,{400} g
          where 
          t.c700000010<>'已作废'
          and t.C700000005=u.C630000001
          and u.c630000013=g.c1
          {3}
       {4}
       {5}
          group by g.c630000018) a,
          (select t.C630000018 as 处理客服 from T145 t where 
	   	   			      t.C630000021='2' and 
                          ((t.C630000018 like '%分公司%') 
	   	   			   	  or (t.C630000018 like '%区客服%')
						  or (t.C630000018 like '%河北移动%'))
						  and (t.c630000018<>'administrator')
						  and (t.C630000018 <>'神州泰岳')
						  and (t.C630000018 <>'河北移动通讯股份有限公司')) b
          where a.处理客服(+)=b.处理客服) e,
          
          
 (select
b.处理客服,
nvl(a.建议工单超时量,0) as 建议工单超时量
from
(select 
       distinct(处理客服) as 处理客服,
       sum(建议工单超时量) as 建议工单超时量
       from(
        select 
        g.c630000018 as 处理客服 ,
        sum(case when t.C801000002='建议' and ((probak.C700020017 - t.C700000006) - t.C801800015 * 1800) > 0 then 1 else 0 end) as 建议工单超时量
        from {100} t,{500} u,{400} g,(select *from t94  union all select * from t95) propre,(select *from t94  union all select * from t95) probak
        where 
        t.c700000010<>'已作废'
        and ((propre.C700020011 = '已完成' or propre.C700020011 = '已关闭') and propre.c700020019 = 20)
        and probak.C700020020 = 0
        and probak.C700020011 = '已完成'
        and probak.C700020004 = propre.C700020003
        and t.c1 = propre.C700020001
        and t.c1 = probak.C700020001
        and probak.c801000103 = 0
        and t.C700000005=u.C630000001
        and u.c630000013=g.c1
        and g.C630000021='2'
       -- and (  t.c801000016='全球通普通客户' or t.c801000016='未知' or t.c801000016='他网客户' or t.c801000016='本地固话客户' or t.c801000016='异地漫游客户' or t.c801000016='神州行客户' or t.c801000016='动感地带客户' or t.c801000016='长途固话客户' or t.c801000016='集团客户' or t.c801000016='贵宾卡' or t.c801000016='VIP银卡' or t.c801000016='VIP金卡' or t.c801000016='VIP钻石卡' or t.c801000016='国际漫游客户') and 1183219200000<(t.c700000006)*1000 and (t.c700000006)*1000<1193068800000  and (  t.c801000018='省中心' or t.c801000018='集团' or t.c801000018='石家庄' or t.c801000018='保定' or t.c801000018='衡水' or t.c801000018='邢台' or t.c801000018='邯郸' or t.c801000018='张家口' or t.c801000018='承德' or t.c801000018='唐山' or t.c801000018='廊坊' or t.c801000018='沧州' or t.c801000018='秦皇岛')
        {3}
       {4}
       {5}
        group by g.c630000018
        union 
        select 
         g.c630000018 as 处理客服 ,
        sum(case when t.C801000002='建议' and ((probak.C700020017 - t.C700000006) - t.C801800015 * 1800) > 0 then 1 else 0 end) as 建议工单超时量
        from {100} t,{500} u,{400} g,(select *from t94  union all select * from t95) propre,(select *from t94  union all select * from t95) probak
        where ((propre.C700020011 = '已完成' or propre.C700020011 = '已关闭') and
               propre.c700020019 = 20)
           and probak.C700020020 = 0
           and (probak.C700020011 = '已驳回' or probak.C700020011 = '已追回')
           and probak.C700020004 = propre.C700020003
            and t.c1 = propre.C700020001
           and t.c1 = probak.C700020001
        and probak.c801000103 = 0
        and t.C700000005=u.C630000001
        and u.c630000013=g.c1
        and g.C630000021='2'
        --and (  t.c801000016='全球通普通客户' or t.c801000016='未知' or t.c801000016='他网客户' or t.c801000016='本地固话客户' or t.c801000016='异地漫游客户' or t.c801000016='神州行客户' or t.c801000016='动感地带客户' or t.c801000016='长途固话客户' or t.c801000016='集团客户' or t.c801000016='贵宾卡' or t.c801000016='VIP银卡' or t.c801000016='VIP金卡' or t.c801000016='VIP钻石卡' or t.c801000016='国际漫游客户') and 1183219200000<(t.c700000006)*1000 and (t.c700000006)*1000<1193068800000  and (  t.c801000018='省中心' or t.c801000018='集团' or t.c801000018='石家庄' or t.c801000018='保定' or t.c801000018='衡水' or t.c801000018='邢台' or t.c801000018='邯郸' or t.c801000018='张家口' or t.c801000018='承德' or t.c801000018='唐山' or t.c801000018='廊坊' or t.c801000018='沧州' or t.c801000018='秦皇岛')
        {3}
       {4}
       {5}
        group by g.c630000018
        union
        select 
         g.c630000018 as 处理客服 ,
        sum(case when t.C801000002='建议' and ((probak.C700020017 - t.C700000006) - t.C801800015 * 1800) > 0 then 1 else 0 end) as 建议工单超时量
        from {100} t,{500} u,{400} g,(select *from t94  union all select * from t95) probak
         where (probak.C700020011 = '已关闭')
           and (probak.C700020019 = 0 or probak.C700020019 = 20)
           and probak.c801000101 = 7
           and t.c1 = probak.C700020001
          and probak.c801000103 = 0
         and t.C700000005=u.C630000001
        and u.c630000013=g.c1
        and g.C630000021='2'
       -- and (  t.c801000016='全球通普通客户' or t.c801000016='未知' or t.c801000016='他网客户' or t.c801000016='本地固话客户' or t.c801000016='异地漫游客户' or t.c801000016='神州行客户' or t.c801000016='动感地带客户' or t.c801000016='长途固话客户' or t.c801000016='集团客户' or t.c801000016='贵宾卡' or t.c801000016='VIP银卡' or t.c801000016='VIP金卡' or t.c801000016='VIP钻石卡' or t.c801000016='国际漫游客户') and 1183219200000<(t.c700000006)*1000 and (t.c700000006)*1000<1193068800000  and (  t.c801000018='省中心' or t.c801000018='集团' or t.c801000018='石家庄' or t.c801000018='保定' or t.c801000018='衡水' or t.c801000018='邢台' or t.c801000018='邯郸' or t.c801000018='张家口' or t.c801000018='承德' or t.c801000018='唐山' or t.c801000018='廊坊' or t.c801000018='沧州' or t.c801000018='秦皇岛')
        {3}
       {4}
       {5}
        group by g.c630000018
        union
        select 
         g.c630000018 as 处理客服 ,
        sum(case when t.C801000002='建议' and ((((to_date(to_char(sysdate, 'yyyy-mm-dd hh24:mi:ss'),
                           'yyyy-mm-dd hh24:mi:ss') -
               to_date('1970-01-01 00:00:00', 'yyyy-mm-dd hh24:mi:ss')) * 3600 * 24) -
               t.C700000006) - t.C801800015 * 1800) > 0 then 1 else 0 end) as 建议工单超时量
        
          from {100} t,{500} u,{400} g,(select *from t94  union all select * from t95) propre
           
         where (propre.c700020011='处理中' or propre.c700020011='待处理')
           and t.c1 = propre.C700020001
           and (propre.c700020020= 1 or propre.c700020020= 2)
           and propre.c801000103 = 0
          and t.C700000005=u.C630000001
        and u.c630000013=g.c1
        and g.C630000021='2'
        --and (  t.c801000016='全球通普通客户' or t.c801000016='未知' or t.c801000016='他网客户' or t.c801000016='本地固话客户' or t.c801000016='异地漫游客户' or t.c801000016='神州行客户' or t.c801000016='动感地带客户' or t.c801000016='长途固话客户' or t.c801000016='集团客户' or t.c801000016='贵宾卡' or t.c801000016='VIP银卡' or t.c801000016='VIP金卡' or t.c801000016='VIP钻石卡' or t.c801000016='国际漫游客户') and 1183219200000<(t.c700000006)*1000 and (t.c700000006)*1000<1193068800000  and (  t.c801000018='省中心' or t.c801000018='集团' or t.c801000018='石家庄' or t.c801000018='保定' or t.c801000018='衡水' or t.c801000018='邢台' or t.c801000018='邯郸' or t.c801000018='张家口' or t.c801000018='承德' or t.c801000018='唐山' or t.c801000018='廊坊' or t.c801000018='沧州' or t.c801000018='秦皇岛')
        {3}
       {4}
       {5}
        group by g.c630000018
     ) group by 处理客服) a,
          (select t.C630000018 as 处理客服 from T145 t where 
	   	   			      t.C630000021='2' and 
                          ((t.C630000018 like '%分公司%') 
	   	   			   	  or (t.C630000018 like '%区客服%')
						  or (t.C630000018 like '%河北移动%'))
						  and (t.c630000018<>'administrator')
						  and (t.C630000018 <>'神州泰岳')
						  and (t.C630000018 <>'河北移动通讯股份有限公司')) b
          where a.处理客服(+)=b.处理客服)  f,
          
      
       (select
b.处理客服,
nvl(a.咨询工单总量,0) as 咨询工单总量
from
(select
          distinct(g.c630000018) as 处理客服,
          sum(case when t.c801000002='咨询' then 1 else 0 end) as 咨询工单总量
          from {100} t,{500} u,{400} g
          where 
          t.c700000010<>'已作废'
          and t.C700000005=u.C630000001
          and u.c630000013=g.c1
         {3}
       {4}
       {5}
         group by g.c630000018) a,
          (select t.C630000018 as 处理客服 from T145 t where 
	   	   			      t.C630000021='2' and 
                          ((t.C630000018 like '%分公司%') 
	   	   			   	  or (t.C630000018 like '%区客服%')
						  or (t.C630000018 like '%河北移动%'))
						  and (t.c630000018<>'administrator')
						  and (t.C630000018 <>'神州泰岳')
						  and (t.C630000018 <>'河北移动通讯股份有限公司')) b
          where a.处理客服(+)=b.处理客服) g,
          
          
 (select
b.处理客服,
nvl(a.咨询工单超时量,0) as 咨询工单超时量
from
(select 
       distinct(处理客服) as 处理客服,
       sum(咨询工单超时量) as 咨询工单超时量
       from(
        select 
        g.c630000018 as 处理客服 ,
        sum(case when t.C801000002='咨询' and ((probak.C700020017 - t.C700000006) - t.C801800015 * 1800) > 0 then 1 else 0 end) as 咨询工单超时量
        from {100} t,{500} u,{400} g,(select *from t94  union all select * from t95) propre,(select *from t94  union all select * from t95) probak
        where 
        t.c700000010<>'已作废'
        and ((propre.C700020011 = '已完成' or propre.C700020011 = '已关闭') and propre.c700020019 = 20)
        and probak.C700020020 = 0
        and probak.C700020011 = '已完成'
        and probak.C700020004 = propre.C700020003
        and t.c1 = propre.C700020001
        and t.c1 = probak.C700020001
        and probak.c801000103 = 0
        and t.C700000005=u.C630000001
        and u.c630000013=g.c1
        and g.C630000021='2'
       --and (  t.c801000016='全球通普通客户' or t.c801000016='未知' or t.c801000016='他网客户' or t.c801000016='本地固话客户' or t.c801000016='异地漫游客户' or t.c801000016='神州行客户' or t.c801000016='动感地带客户' or t.c801000016='长途固话客户' or t.c801000016='集团客户' or t.c801000016='贵宾卡' or t.c801000016='VIP银卡' or t.c801000016='VIP金卡' or t.c801000016='VIP钻石卡' or t.c801000016='国际漫游客户') and 1183219200000<(t.c700000006)*1000 and (t.c700000006)*1000<1193068800000  and (  t.c801000018='省中心' or t.c801000018='集团' or t.c801000018='石家庄' or t.c801000018='保定' or t.c801000018='衡水' or t.c801000018='邢台' or t.c801000018='邯郸' or t.c801000018='张家口' or t.c801000018='承德' or t.c801000018='唐山' or t.c801000018='廊坊' or t.c801000018='沧州' or t.c801000018='秦皇岛')
        {3}
       {4}
       {5}
        group by g.c630000018
        union 
        select 
         g.c630000018 as 处理客服 ,
        sum(case when t.C801000002='咨询' and ((probak.C700020017 - t.C700000006) - t.C801800015 * 1800) > 0 then 1 else 0 end) as 咨询工单超时量
       from {100} t,{500} u,{400} g,(select *from t94  union all select * from t95) propre,(select *from t94  union all select * from t95) probak
        where ((propre.C700020011 = '已完成' or propre.C700020011 = '已关闭') and
               propre.c700020019 = 20)
           and probak.C700020020 = 0
           and (probak.C700020011 = '已驳回' or probak.C700020011 = '已追回')
           and probak.C700020004 = propre.C700020003
            and t.c1 = propre.C700020001
           and t.c1 = probak.C700020001
        and probak.c801000103 = 0
        and t.C700000005=u.C630000001
        and u.c630000013=g.c1
        and g.C630000021='2'
        --and (  t.c801000016='全球通普通客户' or t.c801000016='未知' or t.c801000016='他网客户' or t.c801000016='本地固话客户' or t.c801000016='异地漫游客户' or t.c801000016='神州行客户' or t.c801000016='动感地带客户' or t.c801000016='长途固话客户' or t.c801000016='集团客户' or t.c801000016='贵宾卡' or t.c801000016='VIP银卡' or t.c801000016='VIP金卡' or t.c801000016='VIP钻石卡' or t.c801000016='国际漫游客户') and 1183219200000<(t.c700000006)*1000 and (t.c700000006)*1000<1193068800000  and (  t.c801000018='省中心' or t.c801000018='集团' or t.c801000018='石家庄' or t.c801000018='保定' or t.c801000018='衡水' or t.c801000018='邢台' or t.c801000018='邯郸' or t.c801000018='张家口' or t.c801000018='承德' or t.c801000018='唐山' or t.c801000018='廊坊' or t.c801000018='沧州' or t.c801000018='秦皇岛')
        {3}
       {4}
       {5}
        group by g.c630000018
        union
        select 
         g.c630000018 as 处理客服 ,
        sum(case when t.C801000002='咨询' and ((probak.C700020017 - t.C700000006) - t.C801800015 * 1800) > 0 then 1 else 0 end) as 咨询工单超时量
        from {100} t,{500} u,{400} g,(select *from t94  union all select * from t95) probak
         where (probak.C700020011 = '已关闭')
           and (probak.C700020019 = 0 or probak.C700020019 = 20)
           and probak.c801000101 = 7
           and t.c1 = probak.C700020001
         and probak.c801000103 = 0
         and t.C700000005=u.C630000001
        and u.c630000013=g.c1
        and g.C630000021='2'
                {3}
       {4}
       {5}
        group by g.c630000018
        union
        select 
         g.c630000018 as 处理客服 ,
        sum(case when t.C801000002='咨询' and ((((to_date(to_char(sysdate, 'yyyy-mm-dd hh24:mi:ss'),
                           'yyyy-mm-dd hh24:mi:ss') -
               to_date('1970-01-01 00:00:00', 'yyyy-mm-dd hh24:mi:ss')) * 3600 * 24) -
               t.C700000006) - t.C801800015 * 1800) > 0 then 1 else 0 end) as 咨询工单超时量
        
          from {100} t,{500} u,{400} g,(select *from t94  union all select * from t95) propre
           
         where (propre.c700020011='处理中' or propre.c700020011='待处理')
           and t.c1 = propre.C700020001
           and (propre.c700020020= 1 or propre.c700020020= 2)
          and propre.c801000103 = 0
          and t.C700000005=u.C630000001
        and u.c630000013=g.c1
        and g.C630000021='2'
       {3}
       {4}
       {5}
        group by g.c630000018
     ) group by 处理客服) a,
          (select t.C630000018 as 处理客服 from T145 t where 
	   	   			      t.C630000021='2' and 
                          ((t.C630000018 like '%分公司%') 
	   	   			   	  or (t.C630000018 like '%区客服%')
						  or (t.C630000018 like '%河北移动%'))
						  and (t.c630000018<>'administrator')
						  and (t.C630000018 <>'神州泰岳')
						  and (t.C630000018 <>'河北移动通讯股份有限公司')) b
          where a.处理客服(+)=b.处理客服)  h
 where 
 a.处理客服=b.处理客服
 and b.处理客服=c.处理客服 
 and c.处理客服=d.处理客服 
 and d.处理客服=e.处理客服 
 and e.处理客服=f.处理客服 
 and f.处理客服=g.处理客服 
 and g.处理客服=h.处理客服 
 order by a.处理客服 
)         


		]]></item>
	</sql>

</sql-group>

