<?xml version="1.0" encoding="GB2312"?>
<sql-group>
	<doc>
		<author>duanximeng</author>
		<date>2006-03-26</date>
		<description>青海故障工单统计
			from t268 t,t400 u,t257 pro
			from t268 t,t400 u,t256 pro
		</description>
	</doc>
	<!-- 处理人-->
	<sql name="hbeoms.allformstaterolename_cl" datasource="Ultranms">
		<item dbms="All"><![CDATA[
select
distinct(a.处理人) as 处理人,
a.工单总数,
b.一般,
round(b.一般/(case when a.工单总数=0 then 1 else a.工单总数 end),4)*100 || '%' as 一般率,
c.次要,
round(c.次要/(case when a.工单总数=0 then 1 else a.工单总数 end),4)*100 || '%' as 次要率,
d.重要,
round(d.重要/(case when a.工单总数=0 then 1 else a.工单总数 end),4)*100 || '%' as 重要率,
e.紧急,
round(e.紧急/(case when a.工单总数=0 then 1 else a.工单总数 end),4)*100 || '%' as 紧急率
from
(
select 
b.处理人 as 处理人,nvl(a.工单总数,0) as 工单总数
from
(select
log.c700020403 as 处理人,
count(distinct(t.C1)) as 工单总数
from {1000} t,(select * from {100} union all select * from {200}) log
where
t.C1=log.c700020407
{1}
{3}
and log.c700020408=t.c700000001
and log.C700020402='完成' 
and t.c700000015 in ('重要','次要','一般','紧急')
group by log.c700020403
) a,
(select u.C630000003 as 处理人 from {300} u where 1=1 {2}) b
where a.处理人(+)=b.处理人) a,

(select 
b.处理人 as 处理人,nvl(a.一般,0) as 一般
from
(select
log.c700020403 as 处理人,
count(distinct(t.C1)) as 一般
from {1000} t,(select * from {100} union all select * from {200}) log
where
t.C1=log.c700020407
{1}
{3}
and log.c700020408=t.c700000001
and log.C700020402='完成'
 and t.c700000015='一般'
group by log.c700020403
) a,
(select u.C630000003 as 处理人 from {300} u where 1=1 {2}) b
where a.处理人(+)=b.处理人) b,


(select 
b.处理人 as 处理人,nvl(a.次要,0) as 次要
from
(select
log.c700020403 as 处理人,
count(distinct(t.C1)) as 次要
from {1000} t,(select * from {100} union all select * from {200}) log
where
t.C1=log.c700020407
{1}
{3}
and log.c700020408=t.c700000001
and log.C700020402='完成' 
 and t.c700000015='次要'
group by log.c700020403
) a,
(select u.C630000003 as 处理人 from {300} u where 1=1 {2}) b
where a.处理人(+)=b.处理人) c,

(select 
b.处理人 as 处理人,nvl(a.重要,0) as 重要
from
(select
log.c700020403 as 处理人,
count(distinct(t.C1)) as 重要
from {1000} t,(select * from {100} union all select * from {200}) log
where
t.C1=log.c700020407
{1}
{3}
and log.c700020408=t.c700000001
and log.C700020402='完成'
 and t.c700000015='重要'
group by log.c700020403
) a,
(select u.C630000003 as 处理人 from {300} u where 1=1 {2}) b
where a.处理人(+)=b.处理人) d,

(select 
b.处理人 as 处理人,
nvl(a.紧急,0) as 紧急
from
(select
log.c700020403 as 处理人,
count(distinct(t.C1)) as 紧急
from {1000} t,(select * from {100} union all select * from {200}) log
where
t.C1=log.c700020407
{1}
{3}
and log.c700020408=t.c700000001
and log.C700020402='完成'
 and t.c700000015='紧急'
group by log.c700020403
) a,
(select u.C630000003 as 处理人 from {300} u where 1=1 {2}) b
where a.处理人(+)=b.处理人) e
where
a.处理人=b.处理人
and c.处理人=b.处理人
and c.处理人=d.处理人
and d.处理人=e.处理人

		]]></item>
	</sql>
	<!-- 处理部门-->
		<sql name="hbeoms.allformstatesendscopename_cl" datasource="Ultranms">
		<item dbms="All"><![CDATA[
 select
distinct(a.处理部门) as 处理部门,
a.工单总数,
b.一般,
round(b.一般/(case when a.工单总数=0 then 1 else a.工单总数 end),4)*100 || '%' as 一般率,
c.次要,
round(c.次要/(case when a.工单总数=0 then 1 else a.工单总数 end),4)*100 || '%' as 次要率,
d.重要,
round(d.重要/(case when a.工单总数=0 then 1 else a.工单总数 end),4)*100 || '%' as 重要率,
e.紧急,
round(e.紧急/(case when a.工单总数=0 then 1 else a.工单总数 end),4)*100 || '%' as 紧急率
from
(
select 
b.处理部门 as 处理部门,
nvl(a.工单总数,0) as 工单总数
from
(select
g.c630000018 as 处理部门,
count(distinct(t.C1)) as 工单总数
from {1000} t,(select * from {100} union all select * from {200}) log,{300} u,{400} g,{500} gu
where
t.C1=log.c700020407
{1}
{3}
and log.c700020408=t.c700000001
 and t.c700000015 in ('一般','次要','重要','紧急')
and log.C700020402='完成'
 and log.c700020404=u.c630000001
and u.C1=gu.c620000028
and gu.c620000027=g.C1
group by g.c630000018

) a,
(select g.C630000018 as 处理部门 from {400} g where 1=1 {2}) b
where a.处理部门(+)=b.处理部门) a,

(select 
b.处理部门 as 处理部门,
nvl(a.一般,0) as 一般
from
(select
g.c630000018 as 处理部门,
count(distinct(t.C1)) as 一般
from {1000} t,(select * from {100} union all select * from {200}) log,{300} u,{400} g,{500} gu
where
t.C1=log.c700020407
{1}
{3}
and log.c700020408=t.c700000001
and log.C700020402='完成' 
  and t.c700000015='一般'
 and log.c700020404=u.c630000001
and u.C1=gu.c620000028
and gu.c620000027=g.C1
group by g.c630000018

) a,
(select g.C630000018 as 处理部门 from {400} g where 1=1 {2} ) b
where a.处理部门(+)=b.处理部门) b,


(select 
b.处理部门 as 处理部门,
nvl(a.次要,0) as 次要
from
(select
g.c630000018 as 处理部门,
count(distinct(t.C1)) as 次要
from {1000} t,(select * from {100} union all select * from {200}) log,{300} u,{400} g,{500} gu
where
t.C1=log.c700020407
{1}
{3}
and log.c700020408=t.c700000001
and log.C700020402='完成' 
  and t.c700000015='次要'
 and log.c700020404=u.c630000001
and u.C1=gu.c620000028
and gu.c620000027=g.C1
group by g.c630000018

) a,
(select g.C630000018 as 处理部门 from {400} g where 1=1 {2} ) b
where a.处理部门(+)=b.处理部门) c,

(select 
b.处理部门 as 处理部门,
nvl(a.重要,0) as 重要
from
(select
g.c630000018 as 处理部门,
count(distinct(t.C1)) as 重要
from {1000} t,(select * from {100} union all select * from {200}) log,{300} u,{400} g,{500} gu
where
t.C1=log.c700020407
{1}
{3}
and log.c700020408=t.c700000001
and log.C700020402='完成' 
  and t.c700000015='重要'
 and log.c700020404=u.c630000001
and u.C1=gu.c620000028
and gu.c620000027=g.C1
group by g.c630000018

) a,
(select g.C630000018 as 处理部门 from {400} g where 1=1 {2} ) b
where a.处理部门(+)=b.处理部门) d,

(select 
b.处理部门 as 处理部门,
nvl(a.紧急,0) as 紧急
from
(select
g.c630000018 as 处理部门,
count(distinct(t.C1)) as 紧急
from {1000} t,(select * from {100} union all select * from {200}) log,{300} u,{400} g,{500} gu
where
t.C1=log.c700020407
{1}
{3}
and log.c700020408=t.c700000001
and log.C700020402='完成'
  and t.c700000015='紧急'
 and log.c700020404=u.c630000001
and u.C1=gu.c620000028
and gu.c620000027=g.C1
group by g.c630000018

) a,
(select g.C630000018 as 处理部门 from {400} g where 1=1 {2} ) b
where a.处理部门(+)=b.处理部门) e
where
a.处理部门=b.处理部门
and c.处理部门=b.处理部门
and c.处理部门=d.处理部门
and d.处理部门=e.处理部门

		]]></item>
	</sql>
	<!-- 派单人-->
		<sql name="hbeoms.allformstatesendpfrolename_cl" datasource="Ultranms">
		<item dbms="All"><![CDATA[
select
distinct(b.派单人) as 派单人,
nvl(a.工单总数,0) as 工单总数,
nvl(a.一般,0) as 一般,
nvl(a.一般比率,'0%') as 一般比率,
nvl(a.次要,0) as 次要,
nvl(a.次要比率,'0%') as 次要比率,
nvl(a.重要,0) as 重要,
nvl(a.重要比率,'0%') as 重要比率,
nvl(a.紧急,0) as 紧急,
nvl(a.紧急比率,'0%') as 紧急比率 
from
(select
t.c700000004 as 派单人,
count(distinct(t.C1)) as 工单总数,
sum(case when t.c700000015='一般' then 1 else 0 end ) as 一般,
round(sum(case when t.c700000015='一般' then 1 else 0 end )/(case when count(distinct(t.C1))=0 then 1 else count(distinct(t.C1)) end),4)*100 ||'%' as 一般比率,
sum(case when t.c700000015='次要' then 1 else 0 end ) as 次要,
round(sum(case when t.c700000015='次要' then 1 else 0 end )/(case when count(distinct(t.C1))=0 then 1 else count(distinct(t.C1)) end),4)*100 ||'%' as 次要比率,
sum(case when t.c700000015='重要' then 1 else 0 end ) as 重要,
round(sum(case when t.c700000015='重要' then 1 else 0 end )/(case when count(distinct(t.C1))=0 then 1 else count(distinct(t.C1)) end),4)*100 ||'%' as 重要比率,
sum(case when t.c700000015='紧急' then 1 else 0 end ) as 紧急,
round(sum(case when t.c700000015='紧急' then 1 else 0 end )/(case when count(distinct(t.C1))=0 then 1 else count(distinct(t.C1)) end),4)*100 ||'%' as 紧急比率
from {1000} t
where 1=1 {1} {3}
group by t.c700000004) a,
(select u.C630000003 as 派单人 from {300} u where 1=1 {2}) b
where 
a.派单人(+)=b.派单人
order by b.派单人
		]]></item>
	</sql>
	<!-- 派单部门-->
		<sql name="hbeoms.allformstatesendpfscopename_cl" datasource="Ultranms">
		<item dbms="All"><![CDATA[
select
distinct(b.派单部门) as 派单部门,
nvl(a.工单总数,0) as 工单总数,
nvl(a.一般,0) as 一般,
nvl(a.一般比率,'0%') as 一般比率,
nvl(a.次要,0) as 次要,
nvl(a.次要比率,'0%') as 次要比率,
nvl(a.重要,0) as 重要,
nvl(a.重要比率,'0%') as 重要比率,
nvl(a.紧急,0) as 紧急,
nvl(a.紧急比率,'0%') as 紧急比率 
from
(select
g.c630000018 as 派单部门,
count(distinct(t.C1)) as 工单总数,
sum(case when t.c700000015='一般' then 1 else 0 end ) as 一般,
round(sum(case when t.c700000015='一般' then 1 else 0 end )/(case when count(distinct(t.C1))=0 then 1 else count(distinct(t.C1)) end),4)*100 ||'%' as 一般比率,
sum(case when t.c700000015='次要' then 1 else 0 end ) as 次要,
round(sum(case when t.c700000015='次要' then 1 else 0 end )/(case when count(distinct(t.C1))=0 then 1 else count(distinct(t.C1)) end),4)*100 ||'%' as 次要比率,
sum(case when t.c700000015='重要' then 1 else 0 end ) as 重要,
round(sum(case when t.c700000015='重要' then 1 else 0 end )/(case when count(distinct(t.C1))=0 then 1 else count(distinct(t.C1)) end),4)*100 ||'%' as 重要比率,
sum(case when t.c700000015='紧急' then 1 else 0 end ) as 紧急,
round(sum(case when t.c700000015='紧急' then 1 else 0 end )/(case when count(distinct(t.C1))=0 then 1 else count(distinct(t.C1)) end),4)*100 ||'%' as 紧急比率
from {1000} t,{300} u,{400} g,{500} gu
where
t.c700000005=u.c630000001
and u.C1=gu.c620000028
and gu.c620000027=g.C1
{1} {3}
group by g.c630000018) a,
(select g.C630000018 as 派单部门 from {400} g where 1=1 {2}) b
where 
a.派单部门(+)=b.派单部门
order by b.派单部门
		]]></item>
	</sql>
		<sql name="hbeoms.titlename_cl" datasource="Ultranms">
		<item dbms="All"><![CDATA[
  
select 't'||t.schemaid,BaseCategory.C650000001 as basechname, BaseCategory.C650000002 as basename from {500} BaseCategory,arschema t
where  t.name=BaseCategory.C650000002 and t.schemaid={5}
		]]></item>
	</sql>
</sql-group>

