<?xml version="1.0" encoding="GB2312"?>
<sql-group>
	<doc>
		<author>duanximeng</author>
		<date>2007</date>
		<description></description>
	</doc>
	
	<sql name="Tsdsmy_form_sum_number" datasource="Ultranms">
		<item dbms="All"><![CDATA[
		
		
select 
t.c801000018 || '：' ||'回访数' as 地市回访数,
type.C801800002 as 一级专业,
count(distinct(t.C1)) || '' as 回访数
from {100} t,{700} type,{800} city,(select * from {200} union all select * from {300}) pro,{500} u,{400} g,{600} gu
,{500} uu,{400} gg,{600} gugu
where 
1=1
and t.C1=pro.C700020001
and t.C700000005=u.C630000001
and u.C1=gu.C620000028
and gu.C620000027=g.C1
--and ( g.C630000037 like '%600001%')
{7}
and pro.c700020010=uu.C630000001
and uu.C1=gugu.C620000028
and gugu.C620000027=gg.C1
--and ( gg.C630000037 like '%600001%')
{6}
and (t.C801000003 like type.C801800002 || '%')
and t.c801000018=city.c801800001
and t.c801000068 is not null
and t.c801000068<>'未联系到客户'
and t.c700000010<>'已作废'
{3}{4}{5}
group by t.c801000018,type.C801800002		
		
union all
		
select 
t.c801000018 || '：' ||'成功数' as 地市成功数,
type.C801800002 as 一级专业,
count(distinct(t.C1)) || '' as 成功数
from {100} t,{700} type,{800} city,(select * from {200} union all select * from {300}) pro,{500} u,{400} g,{600} gu
,{500} uu,{400} gg,{600} gugu
where 
1=1
and t.C1=pro.C700020001
and t.C700000005=u.C630000001
and u.C1=gu.C620000028
and gu.C620000027=g.C1
--and ( g.C630000037 like '%600001%')
{7}
and pro.c700020010=uu.C630000001
and uu.C1=gugu.C620000028
and gugu.C620000027=gg.C1
--and ( gg.C630000037 like '%600001%')
{6}
and (t.C801000003 like type.C801800002 || '%')
and t.c801000018=city.c801800001
and t.c801000068 is not null
and t.c801000068<>'未联系到客户'
and t.c801000068<>'不需要回访'
and t.c700000010<>'已作废'
{3}{4}{5}
group by t.c801000018,type.C801800002

union all

select 
t.c801000018 || '：' ||'满意数' as 地市满意数,
type.C801800002 as 一级专业,
count(distinct(t.C1)) || '' as 满意数
from {100} t,{700} type,{800} city,(select * from {200} union all select * from {300}) pro,{500} u,{400} g,{600} gu
,{500} uu,{400} gg,{600} gugu
where 
1=1
and t.C1=pro.C700020001
and t.C700000005=u.C630000001
and u.C1=gu.C620000028
and gu.C620000027=g.C1
--and ( g.C630000037 like '%600001%')
{7}
and pro.c700020010=uu.C630000001
and uu.C1=gugu.C620000028
and gugu.C620000027=gg.C1
--and ( gg.C630000037 like '%600001%')
{6}
and (t.C801000003 like type.C801800002 || '%')
and t.c801000018=city.c801800001
and t.c801000068 is not null
and t.c700000010<>'已作废'
and (t.c801000068='非常满意' or t.c801000068='满意' or t.c801000068='一般')
{3}{4}{5}
group by t.c801000018,type.C801800002

union all

select
a.地市 || '：' || '满意率' as 地市满意率,
a.一级专业,
round(b.总数/(case when a.总数=0 then 1 else a.总数 end),4)*100 || '%' as 满意率
from
(select 
t.c801000018 as 地市,
type.C801800002 as 一级专业,
count(distinct(t.C1)) as 总数
from {100} t,{700} type,{800} city,(select * from {200} union all select * from {300}) pro,{500} u,{400} g,{600} gu
,{500} uu,{400} gg,{600} gugu
where 
1=1
and t.C1=pro.C700020001
and t.C700000005=u.C630000001
and u.C1=gu.C620000028
and gu.C620000027=g.C1
--and ( g.C630000037 like '%600001%')
{7}
and pro.c700020010=uu.C630000001
and uu.C1=gugu.C620000028
and gugu.C620000027=gg.C1
--and ( gg.C630000037 like '%600001%')
{6}
and (t.C801000003 like type.C801800002 || '%')
and t.c801000018=city.c801800001
and t.c801000068 is not null
and t.c801000068<>'未联系到客户'
and t.c700000010<>'已作废'
{3}{4}{5}
group by t.c801000018,type.C801800002) a,
(select 
t.c801000018 as 地市,
type.C801800002 as 一级专业,
count(distinct(t.C1)) as 总数
from {100} t,{700} type,{800} city,(select * from {200} union all select * from {300}) pro,{500} u,{400} g,{600} gu
,{500} uu,{400} gg,{600} gugu
where 
1=1
and t.C1=pro.C700020001
and t.C700000005=u.C630000001
and u.C1=gu.C620000028
and gu.C620000027=g.C1
--and ( g.C630000037 like '%600001%')
{7}
and pro.c700020010=uu.C630000001
and uu.C1=gugu.C620000028
and gugu.C620000027=gg.C1
--and ( gg.C630000037 like '%600001%')
{6}
and (t.C801000003 like type.C801800002 || '%')
and t.c801000018=city.c801800001
and t.c801000068 is not null
and t.c700000010<>'已作废'
and (t.c801000068='非常满意' or t.c801000068='满意' or t.c801000068='一般')
{3}{4}{5}
group by t.c801000018,type.C801800002) b
where a.地市=b.地市
and a.一级专业=b.一级专业
		]]></item>
	</sql>
	<sql name="Tsdsmy_form_sum_type" datasource="Ultranms">
		<item dbms="All"><![CDATA[
select
a.受理地市
from
(select distinct c801800001 || '：'|| '回访数' as 受理地市 from {800} where 1=1 {3}
union all
select distinct c801800001 || '：'|| '成功数' as 受理地市 from {800} where 1=1 {3}
union all
select distinct c801800001 || '：'|| '满意数' as 受理地市 from {800} where 1=1 {3}
union all
select distinct c801800001 || '：'|| '满意率' as 受理地市 from {800} where 1=1 {3}) a
order by a.受理地市
		]]></item>
	</sql>
		<sql name="Tsdsmy_form_sum_city" datasource="Ultranms">
		<item dbms="All"><![CDATA[
select distinct c801800002 from {700} where c801800001='投诉' {3}
		]]></item>
	</sql>
</sql-group>

